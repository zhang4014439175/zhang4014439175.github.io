<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>MySql基础（三） - 热爱生活与梦想</title><meta name=keywords content="博客,程序员,架构师,思考,读书,笔记,技术,分享,大数据,产品"><meta name=author content="凡梦星尘"><meta property="og:title" content="MySql基础（三）"><meta property="og:site_name" content="热爱生活与梦想"><meta property="og:image" content="https://zhang4014439175.github.ioimg/author.jpg"><meta name=title content="MySql基础（三） - 热爱生活与梦想"><meta name=description content="Sample article showcasing basic String syntax."><link rel="shortcut icon" href=https://zhang4014439175.github.ioimg/favicon.ico><link rel=apple-touch-icon href=https://zhang4014439175.github.ioimg/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=https://zhang4014439175.github.ioimg/apple-touch-icon.png><link href=//unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//unpkg.com/imageviewer@1.1.0/dist/viewer.min.css rel=stylesheet><link href=https://zhang4014439175.github.iocss/main.css rel=stylesheet type=text/css><link href=https://zhang4014439175.github.iocss/syntax.css rel=stylesheet type=text/css></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>热爱生活与梦想</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>没有伞的孩子要学会努力奔跑!</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-active"><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>归档</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我</a></li><li class=menu-item><a href=/404.html rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益404</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://zhang4014439175.github.io/post/mysql%E4%B8%89/ itemprop=url>MySql基础（三）</a></h1><div class=post-meta><span class=post-pushdate><i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22T13:04:35+08:00 content="2021-06-12">2021-06-12</time></span>
<span class=post-category><i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a class=post-category-a href=/categories/mysql itemprop=url rel=index><span itemprop=name>MySql</span></a>
&nbsp;</span></span>
<span class=post-wordcount><i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>24481 字</span></span>
<span class=post-readtime><i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>49分钟</span></span>
<span id=/post/mysql%E4%B8%89/ class="leancloud_visitors post-visitor" data-flag-title=MySql基础（三）><i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><h1 id=一约束>一、约束</h1><h2 id=1为什么需要约束>1、为什么需要约束</h2><p>数据完整性(Data Integrity)是指数据的精确性(Accuracy)和可靠性(Reliability)。它是防止数据库中 存在不符合语义规定的数据和防止因错误信息的输入输出造成无效操作或错误信息而提出的。</p><p>为了保证数据的完整性，SQL规范以约束的方式对 <strong>表数据进行额外的条件限制</strong> 。从以下四个方面考虑:</p><ul><li><p>实体完整性：例如，同一个表中，不能存在两条完全相同无法区分的记录</p></li><li><p>域完整性：例如:年龄范围0-120，性别范围“男/女”</p></li><li><p>引用完整性：例如:员工所在部门，在部门表中要能找到这个部门</p></li><li><p>用户自定义完整性：例如:用户名唯一、密码不能为空等，本部门经理的工资不得高于本部门职工的平均工资的5倍。</p></li></ul><h2 id=2什么是约束>2、什么是约束</h2><p>约束是表级的强制规定。</p><p>可以在<strong>创建表时规定约束(通过</strong> CREATE TABLE <strong>语句)</strong>，或者在<strong>表创建之后通过</strong> ALTER TABLE <strong>语句规定 约束</strong>。</p><h2 id=3约束的分类>3、约束的分类</h2><ul><li><p><strong>根据约束数据列的限制，</strong> 约束可分为:</p><p><strong>单列约束</strong> :每个约束只约束一列</p><p><strong>多列约束</strong> :每个约束可约束多列数据</p></li><li><p><strong>根据约束的作用范围</strong> ，约束可分为:</p><p><strong>列级约束</strong> :只能作用在一个列上，跟在列的定义后面</p><p><strong>表级约束</strong> :可以作用在多个列上，不与列一起，而是单独定义</p></li><li><p><strong>根据约束起的作用</strong> ，约束可分为:</p><p>NOT NULL <strong>非空约束，规定某个字段不能为空</strong></p><p>UNIQUE <strong>唯一约束</strong>，<strong>规定某个字段在整个表中是唯一的</strong></p><p>PRIMARY KEY <strong>主键</strong>(<strong>非空且唯一</strong>)<strong>约束</strong></p><p>FOREIGN KEY <strong>外键约束</strong></p><p>CHECK <strong>检查约束</strong></p><p>DEFAULT <strong>默认值约束</strong></p></li></ul><h2 id=4非空约束>4、非空约束</h2><ul><li><p>默认，所有的类型的值都可以是NULL，包括INT、FLOAT等数据类型</p></li><li><p>非空约束只能出现在表对象的列上，只能某个列单独限定非空，不能组合非空</p></li><li><p>一个表可以有很多列都分别限定了非空</p></li><li><p>空字符串&rsquo;&lsquo;不等于NULL，0也不等于NULL</p></li></ul><p>建表前</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>NULL</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span>student(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>sid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>sname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>tel<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>cardid<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>18</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>建表后</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>modify</span><span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>modify</span><span style=color:#bbb> </span>sname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=5唯一性约束>5、唯一性约束</h2><ul><li><p>用来限制某个字段/某列的值不能重复。</p></li><li><p>同一个表可以有多个唯一约束。</p></li><li><p>唯一约束可以是某一个列的值唯一，也可以多个列组合的值唯一。</p></li><li><p>唯一性约束允许列值为空。</p></li><li><p>在创建唯一约束的时候，如果不给唯一约束命名，就默认和列名相同。</p></li><li><p>MySQL<strong>会给唯一约束的列上默认创建一个唯一索引。</strong></p></li></ul><p>(1)建表时</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> 		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> 		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>[<span style=color:#a2f;font-weight:700>constraint</span><span style=color:#bbb> </span><span>约束名</span>]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段名</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>sid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>sname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>tel<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>cardid<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>18</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span>t_course(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>cid<span style=color:#bbb> </span><span style=color:#a2f>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UNIQUE</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>cname<span style=color:#bbb> </span><span style=color:#a2f>VARCHAR</span>(<span style=color:#666>100</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UNIQUE</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>description<span style=color:#bbb> </span><span style=color:#a2f>VARCHAR</span>(<span style=color:#666>200</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>USER</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>id<span style=color:#bbb> </span><span style=color:#a2f>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>NULL</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>NAME<span style=color:#bbb> </span><span style=color:#a2f>VARCHAR</span>(<span style=color:#666>25</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>PASSWORD<span style=color:#bbb> </span><span style=color:#a2f>VARCHAR</span>(<span style=color:#666>16</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#080;font-style:italic>-- 使用表级约束语法
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>uk_name_pwd<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UNIQUE</span>(NAME,PASSWORD)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>(2)建表后指定唯一键约束</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#666>#</span><span>字段列表中如果是一个字段，表示该列的值唯一。如果是两个或更多个字段，那么复合唯一，即多个字段的组合是唯</span><span style=color:#bbb> </span><span>一的</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>方式</span><span style=color:#666>1</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>add</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段列表</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>方式</span><span style=color:#666>2</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>modify</span><span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>字段类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>USER</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ADD</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UNIQUE</span>(NAME,PASSWORD);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>USER</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ADD</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>uk_name_pwd<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UNIQUE</span>(NAME,PASSWORD);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>USER</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>MODIFY</span><span style=color:#bbb> </span>NAME<span style=color:#bbb> </span><span style=color:#a2f>VARCHAR</span>(<span style=color:#666>20</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UNIQUE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>sid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>sname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>tel<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>cardid<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>18</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>add</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(tel);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>add</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(cardid);<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=6复合唯一约束>6、复合唯一约束</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段列表</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>字段列表中写的是多个字段名，多个字段名用逗号分隔，表示那么是复合唯一，即多</span><span style=color:#bbb> </span><span>个字段的组合是唯一的</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#666>#</span><span>学生表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>sid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>学号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>sname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>),<span style=color:#bbb> </span><span style=color:#666>#</span><span>姓名</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span>tel<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>电话</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span>cardid<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>18</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span><span style=color:#666>#</span><span>身份证号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>课程表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>course(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>cid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>课程编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span>cname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#666>#</span><span>课程名称</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>选课表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student_course(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>id<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>sid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>cid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>score<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(sid,cid)<span style=color:#bbb> </span><span style=color:#666>#</span><span>复合唯一</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>student<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>,<span style=color:#b44>&#39;13710011002&#39;</span>,<span style=color:#b44>&#39;101223199012015623&#39;</span>);<span style=color:#666>#</span><span>成功</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>student<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>2</span>,<span style=color:#b44>&#39;李四&#39;</span>,<span style=color:#b44>&#39;13710011003&#39;</span>,<span style=color:#b44>&#39;101223199012015624&#39;</span>);<span style=color:#666>#</span><span>成功</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>course<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1001</span>,<span style=color:#b44>&#39;Java&#39;</span>),(<span style=color:#666>1002</span>,<span style=color:#b44>&#39;MySQL&#39;</span>);<span style=color:#666>#</span><span>成功</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=7主键约束>7、主键约束</h2><p>主键约束相当于 <strong>唯一约束</strong>+<strong>非空约束的组合</strong> ，主键约束列不允许重复，也不允许出现空值。</p><ul><li><p>一个表最多只能有一个主键约束，建立主键约束可以在列级别创建，也可以在表级别上创建。</p></li><li><p>主键约束对应着表中的一列或者多列(复合主键) 如果是多列组合的复合主键约束，那么这些列都不允许为空值，并且组合的值不允许重复。</p></li><li><p>MySQL<strong>的主键名总是</strong>PRIMARY ，就算自己命名了主键约束名也没用。</p></li><li><p>创建主键约束时，系统默认会在所在的列或列组合上建立对应的 <strong>主键索引</strong> (能够根据主键查询 的，就根据主键查询，效率更高)。如果删除主键约束了，主键约束对应的索引就自动删除了。</p></li><li><p>需要注意的一点是，不要修改主键字段的值。因为主键是数据记录的唯一标识，如果修改了主键的值，就有可能会破坏数据的完整性。</p></li></ul><p>1）建表时指定主键约束</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>列级模式</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>[<span style=color:#a2f;font-weight:700>constraint</span><span style=color:#bbb> </span><span>约束名</span>]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段名</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>表级模式</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>temp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>id<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>name<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>temp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>);<span style=color:#666>#</span><span>成功</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>temp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>2</span>,<span style=color:#b44>&#39;李四&#39;</span>);<span style=color:#666>#</span><span>成功</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>temp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>);<span style=color:#666>#</span><span>失败</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>ERROR<span style=color:#bbb> </span><span style=color:#666>1062</span><span style=color:#bbb> </span>(<span style=color:#666>23000</span>):<span style=color:#bbb> </span>Duplicate(<span>重复</span>)<span style=color:#bbb> </span>entry(<span>键入，输入</span>)<span style=color:#bbb> </span><span style=color:#b44>&#39;1&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>for</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span><span style=color:#b44>&#39;PRIMARY&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>temp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;王五&#39;</span>);<span style=color:#666>#</span><span>失败</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>ERROR<span style=color:#bbb> </span><span style=color:#666>1062</span><span style=color:#bbb> </span>(<span style=color:#666>23000</span>):<span style=color:#bbb> </span>Duplicate<span style=color:#bbb> </span>entry<span style=color:#bbb> </span><span style=color:#b44>&#39;1&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>for</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span><span style=color:#b44>&#39;PRIMARY&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>temp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>3</span>,<span style=color:#b44>&#39;张三&#39;</span>);<span style=color:#666>#</span><span>成功</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>2）复合主键</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段名</span><span style=color:#666>1</span>,<span>字段名</span><span style=color:#666>2</span>)<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#666>#</span><span>表示字段</span><span style=color:#666>1</span><span>和字段</span><span style=color:#666>2</span><span>的组合是唯一的，也可以有更多个字段</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>学生表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>sid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>学号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>sname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>学生姓名</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>课程表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>course(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>cid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>课程编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>cname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>课程名称</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>选课表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>student_course(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>sid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>cid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>score<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(sid,cid)<span style=color:#bbb> </span><span style=color:#666>#</span><span>复合主键</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>student<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>),(<span style=color:#666>2</span>,<span style=color:#b44>&#39;李四&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>course<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1001</span>,<span style=color:#b44>&#39;Java&#39;</span>),(<span style=color:#666>1002</span>,<span style=color:#b44>&#39;MySQL&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>student_course<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#bbb> </span><span style=color:#666>1001</span>,<span style=color:#bbb> </span><span style=color:#666>89</span>),(<span style=color:#666>1</span>,<span style=color:#666>1002</span>,<span style=color:#666>90</span>),(<span style=color:#666>2</span>,<span style=color:#666>1001</span>,<span style=color:#666>88</span>),(<span style=color:#666>2</span>,<span style=color:#666>1002</span>,<span style=color:#666>56</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=8列级约束表级约束>8、列级约束、表级约束</h2><p>（1）作用范围</p><p>列级约束：只能应用于一列上。</p><p>表级约束：可以应用于一列上，也可以应用在一个表中的多个列上。</p><p>（即：如果你创建的约束涉及到该表的多个属性列，则必须创建的是表级约束（必须定义在表级上）；否则既可以定义在列级上也可以定义在表级上此时只是SQL语句格式不同而已）</p><p>（2）指定</p><p>列级约束：包含在列定义中，直接跟在该列的其它定义之后 ，用空格分隔；不必指定列名</p><p>表级约束：与列定义相互独立，不包含在列定义中；与定义用‘，’分隔；必须指出要约束的列的名称</p><p>（注：因为在创建列级约束时，只需将创建列约束的语句添加到该字段（列）的定义子句后面；而在创建表级约束时，需要将创建表级约束的语句添加到各个字段（列）定义语句的后面，因为并不是每个定义的字段都要创建约束，所以必须指明需要创建的约束的列名。）</p><h2 id=9自增列>9、自增列</h2><p>auto_increment</p><p>1)一个表最多只能有一个自增长列</p><p>(2)当需要产生唯一标识符或顺序值时，可设置自增长</p><p>(3)自增长列约束的列必须是键列(主键列，唯一键列)</p><p>(4)自增约束的列的数据类型必须是整数类型</p><p>(5)如果自增列指定了 0 和 null，会在当前最大值的基础上自增;如果自增列手动指定了具体值，直接 赋值为具体值。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>auto_increment,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span><span style=color:#bbb> </span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>auto_increment,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span>,,<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段名</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>--建表前
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>auto_increment,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>--建表后
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>modify</span><span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span>auto_increment;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>modify</span><span style=color:#bbb> </span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span>auto_increment;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>--删除主键自增
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>modify</span><span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=10外键>10、外键</h2><p>FOREIGN KEY</p><h3 id=1主表和从表父表和子表>1）主表和从表/父表和子表</h3><p>主表(父表)：被引用的表，被参考的表</p><p>从表(子表)：引用别人的表，参考别人的表</p><p>例如：员工表的员工所在部门这个字段的值要参考部门表:部门表是主表，员工表是从表。</p><p>例如：学生表、课程表、选课表:选课表的学生和课程要分别参考学生表和课程表，学生表和课程表是主表，选课表是从表。</p><h3 id=2特点>2）特点</h3><p>(1)、从表的外键列，必须引用/参考主表的主键或唯一约束的列为什么？因为被依赖/被参考的值必须是唯一的</p><p>(2)、在创建外键约束时，如果不给外键约束命名， <strong>默认名不是列名，而是自动产生一个外键名</strong> (例如 student_ibfk_1;)，也可以指定外键约束名。</p><p>(3)、创建(CREATE)表时就指定外键约束的话，先创建主表，再创建从表 (4)删表时，先删从表(或先删除外键约束)，再删除主表</p><p>(5)、当主表的记录被从表参照时，主表的记录将不允许删除，如果要删除数据，需要先删除从表中依赖 该记录的数据，然后才可以删除主表的数据</p><p>(6)、在“从表”中指定外键约束，并且一个表可以建立多个外键约束</p><p>(7)、从表的外键列与主表被参照的列名字可以不相同，但是数据类型必须一样，逻辑意义一致。如果类 型不一样，创建子表时，就会出现错误“ERROR 1005 (HY000): Can&rsquo;t create table&rsquo;database.tablename&rsquo;(errno: 150)”。</p><p>(8)、<strong>当创建外键约束时，系统默认会在所在的列上建立对应的普通索引</strong> 。但是索引名是外键的约束 名。(根据外键查询效率很高)</p><p>(9)、删除外键约束后，必须 手动 删除对应的索引</p><h3 id=3建表时建立>3）建表时建立</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>主表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段</span><span style=color:#666>1</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span>字段</span><span style=color:#666>2</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>从表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span>字段</span><span style=color:#666>1</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段</span><span style=color:#666>2</span><span style=color:#bbb> </span><span>数据类型</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>[<span style=color:#a2f;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span><span style=color:#666>&lt;</span><span>外键约束名称</span><span style=color:#666>&gt;</span>]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOREIGN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>KEY</span>(<span>从表的某个字段</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>references</span><span style=color:#bbb> </span><span>主表名</span>(<span>被参考字段</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span>(<span>从表的某个字段</span>)<span>的数据类型必须与主表名</span>(<span>被参考字段</span>)<span>的数据类型一致，逻辑意义也一样</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span>(<span>从表的某个字段</span>)<span>的字段名可以与主表名</span>(<span>被参考字段</span>)<span>的字段名一样，也可以不一样</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>-- FOREIGN KEY: 在表级指定子表中的列 -- REFERENCES: 标示在父表中的列
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>dept(<span style=color:#bbb> </span><span style=color:#666>#</span><span>主表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>did<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>dname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>50</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门名称</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp(<span style=color:#666>#</span><span>从表</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>5</span>),<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工姓名</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>deptid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工所在的部门</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>foreign</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>(deptid)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>references</span><span style=color:#bbb> </span>dept(did)<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#666>#</span>emp表的deptid和和dept表的did的数据类型一致<span>，意义都是表示部门的编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span>说明</span>:<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>(<span style=color:#666>1</span>)<span>主表</span>dept必须先创建成功<span>，然后才能创建</span>emp表<span>，指定外键成功。</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>(<span style=color:#666>2</span>)<span>删除表时，先删除从表</span>emp<span>，再删除主表</span>dept<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=4建表后建立>4）建表后建立</h3><p>一般情况下，表与表的关联都是提前设计好了的，因此，会在创建表的时候就把外键约束定义好。不过，如果需要修改表的设计(比如添加新的字段，增加新的关联关系)，但没有预先定义外键约束，那么，就要用修改表的方式来补充定义。</p><p>格式:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span>从表名</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>ADD</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span><span>约束名</span>]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOREIGN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>KEY</span><span style=color:#bbb> </span>(<span>从表的字段</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>REFERENCES</span><span style=color:#bbb> </span><span>主表名</span>(<span>被引用</span><span style=color:#bbb> </span><span>字段</span>)<span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>update</span><span style=color:#bbb> </span>xx][<span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>delete</span><span style=color:#bbb> </span>xx];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span>emp1<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>ADD</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>CONSTRAINT</span><span style=color:#bbb> </span>emp_dept_id_fk]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOREIGN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>KEY</span>(dept_id)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>REFERENCES</span><span style=color:#bbb> </span>dept(dept_id);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>dept(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>did<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span>dname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>50</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门名称</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>5</span>),<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工姓名</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>deptid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#666>#</span><span>员工所在的部门</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>这两个表创建时，没有指定外键的话，那么创建顺序是随意</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>add</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>foreign</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>(deptid)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>references</span><span style=color:#bbb> </span>dept(did);<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>dept(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>did<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span>dname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>50</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门名称</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>5</span>),<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工姓名</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>did<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工所在的部门</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>foreign</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>(did)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>references</span><span style=color:#bbb> </span>dept(did)<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span style=color:#666>#</span>emp表的deptid和和dept表的did的数据类型一致<span>，意义都是表示部门的编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span style=color:#666>#</span><span>是否重名没问题，因为两个</span>did在不同的表中<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=5约束等级>5）约束等级</h3><p><strong>Cascade方式</strong>：在父表上update/delete记录时，同步update/delete掉子表的匹配记录</p><p><strong>Set null方式</strong>：在父表上update/delete记录时，将子表上匹配记录的列设为null，但是要注意子表的外键列不能为not null</p><p><strong>No action方式</strong>：如果子表中有匹配的记录，则不允许对父表对应候选键进行update/delete操作</p><p><strong>Restrict方式</strong>：同no action， 都是立即检查外键约束</p><p><strong>Set default方式</strong>：(在可视化工具SQLyog中可能显示空白):父表有变更时，子表将外键列设置成一个默认的值，但Innodb不能识别</p><p>(1)演示1:on update cascade on delete set null</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>dept(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>did<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span>dname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>50</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门名称</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>5</span>),<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工姓名</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>deptid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工所在的部门</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>foreign</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>(deptid)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>references</span><span style=color:#bbb> </span>dept(did)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>update</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>cascade</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>delete</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>set</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span style=color:#666>#</span><span>把修改操作设置为级联修改等级，把删除操作设置为</span><span style=color:#a2f;font-weight:700>set</span><span style=color:#bbb> </span>null等级<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1001</span>,<span style=color:#b44>&#39;教学部&#39;</span>);<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1002</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;财务部&#39;</span>);<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1003</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;咨询部&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>,<span style=color:#666>1001</span>);<span style=color:#bbb> </span><span style=color:#666>#</span><span>在添加这条记录时，要求部门表有</span><span style=color:#666>1001</span><span>部门</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>2</span>,<span style=color:#b44>&#39;李四&#39;</span>,<span style=color:#666>1001</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>3</span>,<span style=color:#b44>&#39;王五&#39;</span>,<span style=color:#666>1002</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>修改主表成功，从表也跟着修改，修改了主表被引用的字段</span><span style=color:#666>1002</span><span>为</span><span style=color:#666>1004</span><span>，从表的引用字段就跟着修改为</span><span style=color:#666>1004</span><span>了</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>update</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>set</span><span style=color:#bbb> </span>did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1004</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>where</span><span style=color:#bbb> </span>did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1002</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>from</span><span style=color:#bbb> </span>dept;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>select</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>from</span><span style=color:#bbb> </span>emp;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>删除主表的记录成功，从表对应的字段的值被修改为</span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>delete</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>from</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>where</span><span style=color:#bbb> </span>did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1001</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>(2)演示2:on update set null on delete cascade</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>dept(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>did<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span>dname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>50</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门名称</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>5</span>),<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工姓名</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>deptid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工所在的部门</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>foreign</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>(deptid)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>references</span><span style=color:#bbb> </span>dept(did)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>update</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>set</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>delete</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>cascade</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span style=color:#666>#</span><span>把修改操作设置为</span><span style=color:#a2f;font-weight:700>set</span><span style=color:#bbb> </span>null等级<span>，把删除操作设置为级联删除等级</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1001</span>,<span style=color:#b44>&#39;教学部&#39;</span>);<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1002</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;财务部&#39;</span>);<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1003</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;咨询部&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>,<span style=color:#666>1001</span>);<span style=color:#bbb> </span><span style=color:#666>#</span><span>在添加这条记录时，要求部门表有</span><span style=color:#666>1001</span><span>部门</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>2</span>,<span style=color:#b44>&#39;李四&#39;</span>,<span style=color:#666>1001</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>3</span>,<span style=color:#b44>&#39;王五&#39;</span>,<span style=color:#666>1002</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>修改主表，从表对应的字段设置为</span><span style=color:#a2f;font-weight:700>null</span><span>，主表是</span>dept<span>，从表是</span>emp<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>update</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>set</span><span style=color:#bbb> </span>did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1004</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>where</span><span style=color:#bbb> </span>did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1002</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>删除主表的记录成功，主表的</span><span style=color:#666>1001</span><span>行被删除了，从表相应的记录也被删除了</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>delete</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>from</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>where</span><span style=color:#bbb> </span>did<span style=color:#666>=</span><span style=color:#666>1001</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>(3)演示:on update cascade on delete cascade</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>dept(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>did<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门编号</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  		</span>dname<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>50</span>)<span style=color:#bbb> </span><span style=color:#666>#</span><span>部门名称</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工编号</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>5</span>),<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工姓名</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>deptid<span style=color:#bbb> </span><span style=color:#a2f>int</span>,<span style=color:#bbb> </span><span style=color:#666>#</span><span>员工所在的部门</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>foreign</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>(deptid)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>references</span><span style=color:#bbb> </span>dept(did)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>update</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>cascade</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>on</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>delete</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>cascade</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span style=color:#666>#</span><span>把修改操作设置为级联修改等级，把删除操作也设置为级联删除等级</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1001</span>,<span style=color:#b44>&#39;教学部&#39;</span>);<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1002</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;财务部&#39;</span>);<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1003</span>,<span style=color:#bbb> </span><span style=color:#b44>&#39;咨询部&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>,<span style=color:#666>1001</span>);<span style=color:#bbb> </span><span style=color:#666>#</span><span>在添加这条记录时，要求部门表有</span><span style=color:#666>1001</span><span>部门</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>2</span>,<span style=color:#b44>&#39;李四&#39;</span>,<span style=color:#666>1001</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>3</span>,<span style=color:#b44>&#39;王五&#39;</span>,<span style=color:#666>1002</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>修改主表，从表对应的字段自动修改</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>update</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>set</span><span style=color:#bbb> </span>did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1004</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>where</span><span style=color:#bbb> </span>did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1002</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>#</span><span>删除主表的记录成功，主表的</span><span style=color:#666>1001</span><span>行被删除了，从表相应的记录也被删除了</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>delete</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>from</span><span style=color:#bbb> </span>dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>where</span><span style=color:#bbb> </span>did<span style=color:#666>=</span><span style=color:#666>1001</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=6删除>6）删除</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span>(<span style=color:#666>1</span>)<span>第一步先查看约束名和删除外键约束</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>information_schema.table_constraints<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table_name</span><span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;表名称&#39;</span>;<span style=color:#666>#</span><span>查看某个</span><span style=color:#bbb> </span><span>表的约束名</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span>从表名</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DROP</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOREIGN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>KEY</span><span style=color:#bbb> </span><span>外键约束名</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>(<span style=color:#666>2</span>)<span>第二步查看索引名和删除索引。</span>(<span>注意，只能手动删除</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INDEX</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span><span>表名称</span>;<span style=color:#bbb> </span><span style=color:#666>#</span><span>查看某个表的索引名</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span><span>从表名</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DROP</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INDEX</span><span style=color:#bbb> </span><span>索引名</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>information_schema.table_constraints<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table_name</span><span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;emp&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>drop</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>foreign</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span>emp_ibfk_1;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>show</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>index</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>from</span><span style=color:#bbb> </span>emp;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>emp<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>drop</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>index</span><span style=color:#bbb> </span>deptid;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>问题</strong>1**:如果两个表之间有关系(一对一、一对多)，比如:员工表和部门表(一对多)，它们之间是否一定要建外键约束?**</p><p>答:不是的</p><p><strong>问题</strong>2**:建和不建外键约束有什么区别?**</p><p>答:建外键约束，你的操作(创建表、删除表、添加、修改、删除)会受到限制，从语法层面受到限制。例如:在员工表中不可能添加一个员工信息，它的部门的值在部门表中找不到。</p><p>不建外键约束，你的操作(创建表、删除表、添加、修改、删除)不受限制，要保证数据的 引用完整
性 ，只能依 靠程序员的自觉 ，或者是 在Java程序中进行限定 。例如:在员工表中，可以添加一个员工的 信息，它的部门指定为一个完全不存在的部门。</p><p><strong>问题</strong>3**:那么建和不建外键约束和查询有没有关系?**</p><p>答:没有</p><h2 id=11check约束>11、CHECK约束</h2><p>检查某个字段的值是否符号xx要求，一般指的是值的范围</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>5</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>gender<span style=color:#bbb> </span><span style=color:#a2f>char</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>check</span><span style=color:#bbb> </span>(<span style=color:#b44>&#39;男&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>or</span><span style=color:#bbb> </span><span style=color:#b44>&#39;女&#39;</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>insert</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>into</span><span style=color:#bbb> </span>employee<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>values</span>(<span style=color:#666>1</span>,<span style=color:#b44>&#39;张三&#39;</span>,<span style=color:#b44>&#39;妖&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span>temp(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>id<span style=color:#bbb> </span><span style=color:#a2f>INT</span><span style=color:#bbb> </span>AUTO_INCREMENT,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>NAME<span style=color:#bbb> </span><span style=color:#a2f>VARCHAR</span>(<span style=color:#666>20</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>age<span style=color:#bbb> </span><span style=color:#a2f>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CHECK</span>(age<span style=color:#bbb> </span><span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#666>20</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>PRIMARY</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>KEY</span>(id)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>age<span style=color:#bbb> </span>tinyint<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>check</span>(age<span style=color:#bbb> </span><span style=color:#666>&gt;</span><span style=color:#666>20</span>)<span style=color:#bbb> </span><span>或</span><span style=color:#bbb> </span>sex<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>2</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>check</span>(sex<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>in</span>(<span>‘男’</span>,<span>’女’</span>))<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CHECK</span>(height<span style=color:#666>&gt;=</span><span style=color:#666>0</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>height<span style=color:#666>&lt;</span><span style=color:#666>3</span>)<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=12default约束>12、DEFAULT约束</h2><p>给某个字段/某列指定默认值，一旦设置默认值，在插入数据时，如果此字段没有显式赋值，则赋值为默 认值。</p><h3 id=1建表时添加>1）建表时添加</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span><span style=color:#bbb> </span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span>,<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>  	</span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段名</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>unique</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>(<span>字段名</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span>说明：默认值约束一般不在唯一键和主键列上加</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>eid<span style=color:#bbb> </span><span style=color:#a2f>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>ename<span style=color:#bbb> </span><span style=color:#a2f>varchar</span>(<span style=color:#666>20</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>gender<span style=color:#bbb> </span><span style=color:#a2f>char</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span style=color:#b44>&#39;男&#39;</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>tel<span style=color:#bbb> </span><span style=color:#a2f>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>null</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span style=color:#b44>&#39;&#39;</span><span style=color:#bbb> </span><span style=color:#666>#</span><span>默认是空字符串</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=2建表后添加>2）建表后添加</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span>modify<span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#如果这个字段原来有非空约束，你还保留非空约束，那么在加默认值约束时，还得保留非空约束，否则非空约束就被 删除了 #同理，在给某个字段加非空约束也一样，如果这个字段原来有默认值约束，你想保留，也要在modify语句中保留默 认值约束，否则就删除了
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span>modify<span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>默认值</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#800>null</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>create</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span style=color:#00a000>employee</span>(<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>eid<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>int</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>primary</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>key</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>ename<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>varchar</span>(<span style=color:#666>20</span>),<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>gender<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>char</span>,<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>tel<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#800>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee<span style=color:#bbb> </span>modify<span style=color:#bbb> </span>gender<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>char</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span style=color:#b44>&#39;男&#39;</span>;<span style=color:#bbb> </span><span style=color:#080;font-style:italic>#给gender字段增加默认值约束 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee<span style=color:#bbb> </span>modify<span style=color:#bbb> </span>tel<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span style=color:#b44>&#39;&#39;</span>;<span style=color:#bbb> </span><span style=color:#080;font-style:italic>#给tel字段增加默认值约束
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee<span style=color:#bbb> </span>modify<span style=color:#bbb> </span>tel<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span style=color:#b44>&#39;&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#800>null</span>;<span style=color:#080;font-style:italic>#给tel字段增加默认值约束，并 保留非空约束
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span>modify<span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span>;<span style=color:#080;font-style:italic>#删除默认值约束，也不保留非空约束
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span><span>表名称</span><span style=color:#bbb> </span>modify<span style=color:#bbb> </span><span>字段名</span><span style=color:#bbb> </span><span>数据类型</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#800>null</span>;<span style=color:#bbb> </span><span style=color:#080;font-style:italic>#删除默认值约束，保留非空约束
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee<span style=color:#bbb> </span>modify<span style=color:#bbb> </span>gender<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>char</span>;<span style=color:#bbb> </span><span style=color:#080;font-style:italic>#删除gender字段默认值约束，如果有非空约束，也一并删除 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>alter</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>table</span><span style=color:#bbb> </span>employee<span style=color:#bbb> </span>modify<span style=color:#bbb> </span>tel<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>char</span>(<span style=color:#666>11</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>not</span><span style=color:#bbb> </span><span style=color:#800>null</span>;<span style=color:#080;font-style:italic>#删除tel字段默认值约束，保留非空约束
</span></span></span></code></pre></div><p><strong>面试</strong>1**、为什么建表时，加** not null default &rsquo;&rsquo; <strong>或</strong> default 0</p><p>答:不想让表中出现null值。</p><p><strong>面试</strong>2**、为什么不想要** null <strong>的值</strong></p><p>答:</p><p>(1)不好比较。null是一种特殊值，比较时只能用专门的is null 和 is not null来比较。碰到运算符，通 常返回null。</p><p>(2)效率不高。影响提高索引效果。因此，我们往往在建表时 not null default &rsquo;&rsquo; 或 default 0</p><p><strong>面试</strong>3**、带<strong>AUTO_INCREMENT</strong>约束的字段值是从1开始的吗?**</p><p>在MySQL中，默认AUTO_INCREMENT的初始 值是1，每新增一条记录，字段值自动加1。设置自增属性(AUTO_INCREMENT)的时候，还可以指定第 一条插入记录的自增字段的值，这样新插入的记录的自增字段值从初始值开始递增，如在表中插入第一 条记录，同时指定id值为5，则以后插入的记录的id值就会从6开始往上增加。添加主键约束时，往往需要 设置字段自动增加属性。</p><p><strong>面试</strong>4**、并不是每个表都可以任意选择存储引擎?** 外键约束(FOREIGN KEY)不能跨引擎使用。</p><p>MySQL支持多种存储引擎，每一个表都可以指定一个不同的存储引擎，需要注意的是:外键约束是用来 保证数据的参照完整性的，如果表之间需要关联外键，却指定了不同的存储引擎，那么这些表之间是不 能创建外键约束的。所以说，存储引擎的选择也不完全是随意的。</p><h1 id=二视图>二、视图</h1><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>视图一方面可以帮我们使用表的一部分而不是所有的表，另一方面也可以针对不同的用户制定不同的查
</span></span><span style=display:flex><span>询视图。比如，针对一个公司的销售人员，我们只想给他看部分数据，而某些特殊的数据，比如采购的
</span></span><span style=display:flex><span>价格，则不会提供给他。再比如，人员薪酬是个敏感的字段，那么只给某个级别以上的人员开放，其他
</span></span><span style=display:flex><span>人的查询视图中则不提供这个字段。
</span></span><span style=display:flex><span>刚才讲的只是视图的一个使用场景，实际上视图还有很多作用。最后，我们总结视图的优点。
</span></span></code></pre></div><ul><li><p>视图是一种 虚拟表 ，本身是 不具有数据 的，占用很少的内存空间，它是 SQL 中的一个重要概念。</p></li><li><p><strong>视图建立在已有表的基础上</strong>, 视图赖以建立的这些表称为<strong>基表</strong>。</p></li><li><p>视图的创建和删除只影响视图本身，不影响对应的基表。但是当对视图中的数据进行增加、删除和修改操作时，数据表中的数据会相应地发生变化，反之亦然。</p></li><li><p>向视图提供数据内容的语句为 SELECT 语句, 可以将视图理解为<strong>存储起来的</strong> SELECT <strong>语句</strong></p><ul><li>在数据库中，视图不会保存数据，数据真正保存在数据表中。当对视图中的数据进行增加、删
除和修改操作时，数据表中的数据会相应地发生变化;反之亦然。</li></ul></li><li><p>视图，是向用户提供基表数据的另一种表现形式。通常情况下，小型项目的数据库可以不使用视图，但是在大型项目中，以及数据表比较复杂的情况下，视图的价值就凸显出来了，它可以帮助我们把经常查询的结果集放到虚拟表中，提升使用效率。理解和使用起来都非常方便。</p></li></ul><h2 id=1创建视图>1、创建视图</h2><p><strong>在</strong> CREATE VIEW <strong>语句中嵌入子查询</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>OR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>REPLACE</span>]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>[ALGORITHM<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span>{</span>UNDEFINED<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>MERGE<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>TEMPTABLE<span>}</span>]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span><span>视图名称</span><span style=color:#bbb> </span>[(<span>字段列表</span>)]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb> </span><span>查询语句</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>[<span style=color:#a2f;font-weight:700>WITH</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>CASCADED</span><span style=color:#666>|</span><span style=color:#a2f;font-weight:700>LOCAL</span>]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CHECK</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>OPTION</span>]<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span>empvu80<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb>  </span>employee_id,<span style=color:#bbb> </span>last_name,<span style=color:#bbb> </span>salary<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb>    </span>employees<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb>   </span>department_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>80</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span>emp_year_salary<span style=color:#bbb> </span>(ename,year_salary)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>ename,salary<span style=color:#666>*</span><span style=color:#666>12</span><span style=color:#666>*</span>(<span style=color:#666>1</span><span style=color:#666>+</span>IFNULL(commission_pct,<span style=color:#666>0</span>))<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>t_employee;<span style=color:#bbb>
</span></span></span></code></pre></div><p>说明1:实际上就是我们在 SQL 查询语句的基础上封装了视图 VIEW，这样就会基于 SQL 语句的结果集形 成一张虚拟表。</p><p>说明2:在创建视图时，没有在视图名后面指定字段列表，则视图中字段列表默认和SELECT语句中的字 段列表一致。如果SELECT语句中给字段取了别名，那么视图中的字段名和别名相同。</p><h3 id=1多表联合视图>1）多表联合视图</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span>empview<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span>emp_id,last_name<span style=color:#bbb> </span>NAME,department_name<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span>e,departments<span style=color:#bbb> </span>d<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>e.department_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>d.department_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span>emp_dept<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>ename,dname<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>t_employee<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LEFT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>JOIN</span><span style=color:#bbb> </span>t_department<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ON</span><span style=color:#bbb> </span>t_employee.did<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>t_department.did;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span>dept_sum_vu(name,<span style=color:#bbb> </span>minsal,<span style=color:#bbb> </span>maxsal,<span style=color:#bbb> </span>avgsal)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>d.department_name,<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>MIN</span>(e.salary),<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>MAX</span>(e.salary),<span style=color:#a2f;font-weight:700>AVG</span>(e.salary)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span>e,<span style=color:#bbb> </span>departments<span style=color:#bbb> </span>d<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>e.department_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>d.department_id<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>GROUP</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>BY</span><span style=color:#bbb>  </span>d.department_name;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=2利用视图对数据进行格式化>2）利用视图对数据进行格式化</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#080;font-style:italic>--我们经常需要输出某个格式的内容，比如我们想输出员工姓名和对应的部门名，对应格式为 emp_name(department_name)，就可以使用视图来完成数据格式化的操作:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span>emp_depart<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>CONCAT(last_name,<span style=color:#b44>&#39;(&#39;</span>,department_name,<span style=color:#b44>&#39;)&#39;</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb> </span>emp_dept<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span>e<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>JOIN</span><span style=color:#bbb> </span>departments<span style=color:#bbb> </span>d<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>e.department_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>d.department_id<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=3基于视图创建视图>3）基于视图创建视图</h3><p>当我们创建好一张视图之后，还可以在它的基础上继续创建视图。</p><p>举例:联合“emp_dept”视图和“emp_year_salary”视图查询员工姓名、部门名称、年薪信息创建 “emp_dept_ysalary”视图。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>VIEW</span><span style=color:#bbb> </span>emp_dept_ysalary<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>emp_dept.ename,dname,year_salary<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emp_dept<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INNER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>JOIN</span><span style=color:#bbb> </span>emp_year_salary<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ON</span><span style=color:#bbb> </span>emp_dept.ename<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_year_salary.ename;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=2查看视图>2、查看视图</h2><p>语法1：查看数据库的表对象、视图对象</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:#a2f>TABLES</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>语法2：查看视图的结构</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DESC</span><span style=color:#bbb> </span><span style=color:#666>/</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DESCRIBE</span><span style=color:#bbb> </span><span>视图名称</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>语法3：查看视图的属性信息</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic># 查看视图信息(显示数据表的存储引擎、版本、数据行数和数据大小等) 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>TABLE</span><span style=color:#bbb> </span>STATUS<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;视图名称&#39;</span><span>\</span>G<span style=color:#bbb>
</span></span></span></code></pre></div><p>执行结果显示，注释Comment为VIEW，说明该表为视图，其他的信息为NULL，说明这是一个虚表。</p><p>语法4：查看视图的详细定义信息</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span>VIEW<span style=color:#bbb> </span><span>视图名称</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=3更新视图数据>3、更新视图数据</h2><p>3.1、一般情况</p><p>MySQL支持使用INSERT、UPDATE和DELETE语句对视图中的数据进行插入、更新和删除操作。当视图中的 数据发生变化时，数据表中的数据也会发生变化，反之亦然。</p><p>3.2 不可更新的视图
要使视图可更新，视图中的行和底层基本表中的行之间必须存在 一对一 的关系。另外当视图定义出现如下情况时，视图不支持更新操作:</p><ul><li><p>在定义视图的时候指定了“ALGORITHM = TEMPTABLE”，视图将不支持INSERT和DELETE操作;</p></li><li><p>视图中不包含基表中所有被定义为非空又未指定默认值的列，视图将不支持INSERT操作;</p></li><li><p>在定义视图的SELECT语句中使用了JOIN联合查询，视图将不支持INSERT和DELETE操作;</p></li><li><p>在定义视图的SELECT语句后的字段列表中使用了<strong>数学表达式</strong>或<strong>子查询</strong> ，视图将不支持INSERT，也不支持UPDATE使用了数学表达式、子查询的字段值;</p></li><li><p>在定义视图的SELECT语句后的字段列表中使用 DISTINCT、聚合函数、GROUP BY、HAVING 、UNION 等，视图将不支持INSERT、UPDATE、DELETE;</p></li><li><p>定义视图的SELECT语句中包含了子查询，而子查询中引用了FROM后面的表，视图将不支持 INSERT、UPDATE、DELETE;</p></li><li><p>视图定义基于一个 不可更新视图 ;</p></li><li><p>常量视图。</p></li></ul><h2 id=4修改视图>4、修改视图</h2><p>1）使用CREATE OR REPLACE VIEW子句修改视图</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>OR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>REPLACE</span><span style=color:#bbb> </span>VIEW<span style=color:#bbb> </span><span style=color:#00a000>empvu80</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>(id_number,<span style=color:#bbb> </span>name,<span style=color:#bbb> </span>sal,<span style=color:#bbb> </span>department_id)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb>  </span>employee_id,<span style=color:#bbb> </span>first_name<span style=color:#bbb> </span><span style=color:#666>||</span><span style=color:#bbb> </span><span style=color:#b44>&#39; &#39;</span><span style=color:#bbb> </span><span style=color:#666>||</span><span style=color:#bbb> </span>last_name,<span style=color:#bbb> </span>salary,<span style=color:#bbb> </span>department_id<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>department_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>80</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>2）ALTER VIEW</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-MYSQL data-lang=MYSQL><span style=display:flex><span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span>VIEW<span style=color:#bbb> </span><span>视图名称</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span>查询语句</span><span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=5删除视图>5、删除视图</h2><p>删除视图只是删除视图的定义，并不会删除基表的数据。</p><p>删除视图的语法是:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DROP</span><span style=color:#bbb> </span>VIEW<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>EXISTS</span><span style=color:#bbb> </span><span>视图名称</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DROP</span><span style=color:#bbb> </span>VIEW<span style=color:#bbb> </span>empvu80;<span style=color:#bbb> 
</span></span></span></code></pre></div><p>说明:基于视图a、b创建了新的视图c，如果将视图a或者视图b删除，会导致视图c的查询失败。这样的视图c需要手动删除或修改，否则影响使用。</p><h2 id=6总结>6、总结</h2><ol><li><strong>操作简单</strong></li></ol><p>将经常使用的查询操作定义为视图，可以使开发人员不需要关心视图对应的数据表的结构、表与表之间
的关联关系，也不需要关心数据表之间的业务逻辑和查询条件，而只需要简单地操作视图即可，极大简
化了开发人员对数据库的操作。</p><ol start=2><li><strong>减少数据冗余</strong></li></ol><p>视图跟实际数据表不一样，它存储的是查询语句。所以，在使用的时候，我们要通过定义视图的查询语句来获取结果集。而视图本身不存储数据，不占用数据存储的资源，减少了数据冗余。</p><ol start=3><li><strong>数据安全</strong></li></ol><p>MySQL将用户对数据的访问限制在某些数据的结果集上，而这些数据的结果集可以使用视图来实现。用 户不必直接查询或操作数据表。这也可以理解为视图具有隔离性 。视图相当于在用户和实际的数据表之间加了一层虚拟表。</p><p>同时，MySQL可以根据权限将用户对数据的访问限制在某些视图上， <strong>用户不需要查询数据表，可以直接通过视图获取数据表中的信息</strong> 。这在一定程度上保障了数据表中数据的安全性。</p><ol start=4><li><strong>适应灵活多变的需求</strong></li></ol><p>当业务系统的需求发生变化后，如果需要改动数据表的结构，则工作量相对较大，可以使用视图来减少改动的工作量。这种方式在实际工作中使用得比较多。</p><ol start=5><li><strong>能够分解复杂的查询逻辑</strong></li></ol><p>数据库中如果存在复杂的查询逻辑，则可以将问题进行分解，创建多个视图获取数据，再将创建的多个视图结合起来，完成复杂的查询逻辑。</p><h1 id=三存储过程>三、存储过程</h1><h2 id=1理解>1、理解</h2><h3 id=11含义>1.1、含义</h3><p>存储过程的英文是 Stored Procedure 。它的思想很简单，就是一组经过 预先编译 的 SQL 语句</p><p>的封装。
执行过程:存储过程预先存储在 MySQL 服务器上，需要执行的时候，客户端只需要向服务器端发出调用</p><p>存储过程的命令，服务器端就可以把预先存储好的这一系列 SQL 语句全部执行。</p><h3 id=12好处>1.2、好处</h3><p>1、简化操作，提高了sql语句的重用性，减少了开发程序员的压力</p><p>2、减少操作过程中的失误，提高效率</p><p>3、减少网络传输量(客户端不需要把所有的 SQL 语句通过网络发给服务器)</p><p>4、减少了 SQL 语句暴露在 网上的风险，也提高了数据查询的安全性</p><h3 id=13和视图函数的对比>1.3、和视图、函数的对比</h3><p>它和视图有着同样的优点，清晰、安全，还可以减少网络传输量。不过它和视图不同，视图是虚拟表，通常不对底层数据表直接操作，而存储过程是程序化的 SQL，可以直接操作底层数据表 ，相比于面向集合的操作方式，能够实现一些更复杂的数据处理。</p><p>一旦存储过程被创建出来，使用它就像使用函数一样简单，我们直接通过调用存储过程名即可。相较于函数，存储过程是没有返回值的。</p><h2 id=2分类>2、分类</h2><p>存储过程的参数类型可以是IN、OUT和INOUT。根据这点分类如下:</p><p>1、没有参数(无参数无返回)</p><p>2、仅仅带 IN 类型(有参数无返回)</p><p>3、仅仅带 OUT 类型(无参数有返 回)</p><p>4、既带 IN 又带 OUT(有参数有返回)</p><p>5、带 INOUT(有参数有返回)</p><p>注意:IN、OUT、INOUT 都可以在一个存储过程中带多个。</p><h2 id=3创建>3、创建</h2><p>语法:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-MySQL data-lang=MySQL><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span>存储过程名</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#666>|</span><span style=color:#a2f;font-weight:700>OUT</span><span style=color:#666>|</span><span style=color:#a2f;font-weight:700>INOUT</span><span style=color:#bbb> </span><span>参数名</span><span style=color:#bbb> </span><span>参数类型</span>,...)<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>[characteristics<span style=color:#bbb> </span>...]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span>存储过程体</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb>
</span></span></span></code></pre></div><p>类似于Java中的方法:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span>修饰符</span><span style=color:#bbb> </span><span>返回类型</span><span style=color:#bbb> </span><span>方法名</span>(<span>参数类型</span><span style=color:#bbb> </span><span>参数名</span>,...)<span>{</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>方法体</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span>}</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>说明:</p><h3 id=31参数前面的符号的意思>3.1、参数前面的符号的意思</h3><ul><li><p>IN :当前参数为输入参数，也就是表示入参; 存储过程只是读取这个参数的值。如果没有定义参数种类， 默认就是 IN ，表示输入参数。</p></li><li><p>OUT :当前参数为输出参数，也就是表示出参; 执行完成之后，调用这个存储过程的客户端或者应用程序就可以读取这个参数返回的值了。</p></li><li><p>INOUT :当前参数既可以为输入参数，也可以为输出参数。</p></li></ul><h3 id=32形参类型>3.2、形参类型</h3><p>可以是 MySQL数据库中的任意类型。</p><h3 id=33characteristics>3.3、characteristics</h3><p>表示创建存储过程时指定的对存储过程的约束条件，其取值信息如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>LANGUAGE<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>NOT</span>]<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DETERMINISTIC</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>CONTAINS<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>NO<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>READS</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>DATA<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>MODIFIES</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>DATA<span style=color:#bbb> </span><span>}</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>SECURITY<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>DEFINER<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>INVOKER<span style=color:#bbb> </span><span>}</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb> </span>COMMENT<span style=color:#bbb> </span><span style=color:#b44>&#39;string&#39;</span><span style=color:#bbb>
</span></span></span></code></pre></div><ul><li><p>LANGUAGE SQL :说明存储过程执行体是由SQL语句组成的，当前系统支持的语言为SQL。</p></li><li><p>[NOT] DETERMINISTIC :指明存储过程执行的结果是否确定。DETERMINISTIC表示结果是确定 的。每次执行存储过程时，相同的输入会得到相同的输出。NOT DETERMINISTIC表示结果是不确定 的，相同的输入可能得到不同的输出。如果没有指定任意一个值，默认为NOT DETERMINISTIC。</p></li><li><p>{ CONTAINS SQL | NO SQL | READS SQL DATA | MODIFIES SQL DATA } :指明子程序使 用SQL语句的限制。</p><ul><li><p>CONTAINS SQL表示当前存储过程的子程序包含SQL语句，但是并不包含读写数据的SQL语句;</p></li><li><p>NO SQL表示当前存储过程的子程序中不包含任何SQL语句;</p></li><li><p>READS SQL DATA表示当前存储过程的子程序中包含读数据的SQL语句;</p></li><li><p>MODIFIES SQL DATA表示当前存储过程的子程序中包含写数据的SQL语句。</p></li><li><p>默认情况下，系统会指定为CONTAINS SQL。</p></li></ul></li><li><p>SQL SECURITY { DEFINER | INVOKER } :执行当前存储过程的权限，即指明哪些用户能够执 行当前存储过程。</p><ul><li>DEFINER表示只有当前存储过程的创建者或者定义者才能执行当前存储过程;</li><li>INVOKER表示拥有当前存储过程的访问权限的用户能够执行当前存储过程。</li></ul><p>如果没有设置相关的值，则MySQL默认指定值为DEFINER。</p></li></ul><h3 id=34begin和end>3.4、BEGIN和END</h3><p>存储过程体中可以有多条 SQL 语句，如果仅仅一条SQL 语句，则可以省略 BEGIN 和 END</p><p>编写存储过程并不是一件简单的事情，可能存储过程中需要复杂的 SQL 语句。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#666>1</span>.<span style=color:#bbb> </span>BEGIN...END:BEGIN...END<span style=color:#bbb> </span><span>中间包含了多个语句，每个语句都以</span>(;)<span>号为结束符。</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>2</span>.<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DECLARE</span>:<span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span>用来声明变量，使用的位置在于</span><span style=color:#bbb> </span>BEGIN...END<span style=color:#bbb> </span><span>语句中间，而且需要在其他语句使用之前进</span><span style=color:#bbb> </span><span>行变量的声明。</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>3</span>.<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span>:<span>赋值语句，用于对变量进行赋值。</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>4</span>.<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span>...<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span>:<span>把从数据表中查询的结果存放到变量中，也就是为变量赋值。</span><span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=35需要设置新的结束标记>3.5、需要设置新的结束标记</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span>新的结束标记</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>因为MySQL默认的语句结束符号为分号‘;’。为了避免与存储过程中SQL语句结束符相冲突，需要使用 DELIMITER改变存储过程的结束符。</p><p>比如:“DELIMITER //”语句的作用是将MySQL的结束符设置为//，并以“END //”结束存储过程。存储过程定 义完毕之后再使用“DELIMITER ;”恢复默认结束符。DELIMITER也可以指定其他符号作为结束符。</p><p>当使用DELIMITER命令时，应该避免使用反斜杠(‘\’)字符，因为反斜线是MySQL的转义字符。</p><p>示例:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span>$</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span>存储过程名</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#666>|</span><span style=color:#a2f;font-weight:700>OUT</span><span style=color:#666>|</span><span style=color:#a2f;font-weight:700>INOUT</span><span style=color:#bbb> </span><span>参数名</span><span style=color:#bbb> </span><span>参数类型</span>,...)<span style=color:#bbb> </span>[characteristics<span style=color:#bbb> </span>...]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>sql语句1;<span style=color:#bbb> </span>sql语句2;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span>$</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>代码举例：</p><p>举例1：创建存储过程select_all_data()，查看 emps 表的所有数据</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span>$</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>select_all_data</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span>$</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例2：创建存储过程avg_employee_salary()，返回所有员工的平均工资</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>avg_employee_salary</span><span style=color:#bbb> </span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>AVG</span>(salary)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AS</span><span style=color:#bbb> </span>avg_salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例3：创建存储过程show_max_salary()，用来查看“emps”表的最高薪资值。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>show_max_salary</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>LANGUAGE<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DETERMINISTIC</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>CONTAINS<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>SECURITY<span style=color:#bbb> </span>DEFINER<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>COMMENT<span style=color:#bbb> </span><span style=color:#b44>&#39;查看最高薪资&#39;</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>MAX</span>(salary)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例4：创建存储过程show_min_salary()，查看“emps”表的最低薪资值。并将最低薪资通过OUT参数“ms” 输出</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>show_min_salary</span>(<span style=color:#a2f;font-weight:700>OUT</span><span style=color:#bbb> </span>ms<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>MIN</span>(salary)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>ms<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例5：创建存储过程show_someone_salary()，查看“emps”表的某个员工的薪资，并用IN参数empname 输入员工姓名。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>show_someone_salary</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>empname<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>VARCHAR</span>(<span style=color:#666>20</span>))<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>ename<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>empname;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例6：创建存储过程show_someone_salary2()，查看“emps”表的某个员工的薪资，并用IN参数empname 输入员工姓名，用OUT参数empsalary输出员工薪资。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>show_someone_salary2</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>empname<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>VARCHAR</span>(<span style=color:#666>20</span>),<span style=color:#a2f;font-weight:700>OUT</span><span style=color:#bbb> </span>empsalary<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>empsalary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>ename<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>empname;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例7：创建存储过程show_mgr_name()，查询某个员工领导的姓名，并用INOUT参数“empname”输入员 工姓名，输出领导的姓名。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>show_mgr_name</span>(<span style=color:#a2f;font-weight:700>INOUT</span><span style=color:#bbb> </span>empname<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>VARCHAR</span>(<span style=color:#666>20</span>))<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>ename<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>empname<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>eid<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>(<span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>MID<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>emps<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>ename<span style=color:#666>=</span>empname);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=4使用>4、使用</h2><h3 id=41调用格式>4.1、调用格式</h3><p>存储过程有多种调用方法。存储过程必须使用CALL语句调用，并且存储过程和数据库相关，如果要执行其他数据库中的存储过程，需要指定数据库名称，例如CALL dbname.procname。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-MySQL data-lang=MySQL><span style=display:flex><span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span>存储过程名</span>(<span>实参列表</span>)<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>格式:</strong></p><p>1、调用in模式的参数:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span style=color:#00a000>sp1</span>(<span style=color:#b44>&#39;值&#39;</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>2、调用out模式的参数:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>name;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span style=color:#00a000>sp1</span>(<span style=color:#666>@</span>name);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>name;<span style=color:#bbb>
</span></span></span></code></pre></div><p>3、调用inout模式的参数:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>name;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span style=color:#00a000>sp1</span>(<span style=color:#666>@</span>name);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>name;<span style=color:#bbb>
</span></span></span></code></pre></div><p>示例1：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>CountProc</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>sid<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>,<span style=color:#a2f;font-weight:700>OUT</span><span style=color:#bbb> </span>num<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>COUNT</span>(<span style=color:#666>*</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>num<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>fruits<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>s_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>sid;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 调用存储过程
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span style=color:#00a000>CountProc</span><span style=color:#bbb> </span>(<span style=color:#666>101</span>,<span style=color:#bbb> </span><span style=color:#666>@</span>num);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Query<span style=color:#bbb> </span>OK,<span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span>row<span style=color:#bbb> </span><span style=color:#00a000>affected</span><span style=color:#bbb> </span>(<span style=color:#666>0</span>.<span style=color:#666>00</span><span style=color:#bbb> </span>sec)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 查看返回结果:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>num;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 该存储过程返回了指定 s_id=101 的水果商提供的水果种类，返回值存储在num变量中，使用SELECT查看，返回结果为3
</span></span></span></code></pre></div><p>示例2：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic># 创建存储过程，实现累加运算，计算 1+2+...+n 等于多少。具体的代码如下:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#666>`</span>add_num<span style=color:#666>`</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>n<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>i<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>sum<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>i<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>sum<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>0</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span><span style=color:#a2f;font-weight:700>WHILE</span><span style=color:#bbb> </span>i<span style=color:#bbb> </span><span style=color:#666>&lt;=</span><span style=color:#bbb> </span>n<span style=color:#bbb> </span>DO<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>sum<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>sum<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span>i;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>              </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>i<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>i<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHILE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>sum;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>如果你用的是 Navicat 工具，那么在编写存储过程的时候，Navicat 会自动设置 DELIMITER 为其他符号， 我们不需要再进行 DELIMITER 的操作。</p><p>直接使用 CALL add_num(50); 即可。这里我传入的参数为 50，也就是统计 1+2+&mldr;+50 的积累之和。</p><h3 id=42如何调试>4.2、如何调试</h3><p>在 MySQL 中，存储过程不像普通的编程语言(比如 VC++、Java 等)那样有专门的集成开发环境。因此，你可以通过 SELECT 语句，把程序执行的中间结果查询出来，来调试一个 SQL 语句的正确性。调试 成功之后，把 SELECT 语句后移到下一个 SQL 语句之后，再调试下一个 SQL 语句。这样 逐步推进 ，就可 以完成对存储过程中所有操作的调试了。当然，你也可以把存储过程中的 SQL 语句复制出来，逐段单独 调试。</p><h2 id=5存储函数的使用>5、存储函数的使用</h2><p>前面学习了很多函数，使用这些函数可以对数据进行的各种处理操作，极大地提高用户对数据库的管理效率。MySQL支持自定义函数，定义好之后，调用方式与调用MySQL预定义的系统函数一样。</p><h3 id=51语法>5.1、语法</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span>FUNCTION<span style=color:#bbb> </span><span>函数名</span>(<span>参数名</span><span style=color:#bbb> </span><span>参数类型</span>,...)<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>RETURNS<span style=color:#bbb> </span><span>返回值类型</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>[characteristics<span style=color:#bbb> </span>...]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span>函数体</span><span style=color:#bbb> </span><span style=color:#080;font-style:italic>#函数体中肯定有 RETURN 语句 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>END<span style=color:#bbb>
</span></span></span></code></pre></div><p>说明:</p><p>1、参数列表:指定参数为IN、OUT或INOUT只对PROCEDURE是合法的，FUNCTION中总是默认为IN参 数。</p><p>2、RETURNS type 语句表示函数返回数据的类型; RETURNS子句只能对FUNCTION做指定，对函数而言这是 强制 的。它用来指定函数的返回类型，而且函</p><p>数体必须包含一个 RETURN value 语句。
3、characteristic 创建函数时指定的对函数的约束。取值与创建存储过程时相同，这里不再赘述。</p><p>4、函数体也可以用BEGIN&mldr;END来表示SQL代码的开始和结束。如果函数体只有一条语句，也可以省略 BEGIN&mldr;END。</p><h3 id=52调用存储函数>5.2、调用存储函数</h3><p>在MySQL中，存储函数的使用方法与MySQL内部函数的使用方法是一样的。换言之，用户自己定义的存 储函数与MySQL内部函数是一个性质的。区别在于，存储函数是 用户自己定义 的，而内部函数是MySQL 的 开发者定义 的。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span>函数名</span>(<span>实参列表</span>)<span style=color:#bbb>
</span></span></span></code></pre></div><p>示例1：</p><p>创建存储函数，名称为email_by_name()，参数定义为空，该函数查询Abel的email，并返回，数据类型为 字符串型。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span>FUNCTION<span style=color:#bbb> </span><span style=color:#00a000>email_by_name</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>RETURNS<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>VARCHAR</span>(<span style=color:#666>25</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>DETERMINISTIC</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>CONTAINS<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>RETURN</span><span style=color:#bbb> </span>(<span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>email<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>last_name<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;Abel&#39;</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 调用:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>email_by_name</span>();<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例2：</p><p>创建存储函数，名称为email_by_id()，参数传入emp_id，该函数查询emp_id的email，并返回，数据类型 为字符串型。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span>FUNCTION<span style=color:#bbb> </span><span style=color:#00a000>email_by_id</span>(emp_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>RETURNS<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>VARCHAR</span>(<span style=color:#666>25</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>DETERMINISTIC</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>CONTAINS<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>RETURN</span><span style=color:#bbb> </span>(<span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>email<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#调用
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>emp_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>102</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>email_by_id</span>(<span style=color:#666>102</span>);<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例3：</p><p>创建存储函数count_by_id()，参数传入dept_id，该函数查询dept_id部门的员工人数，并返回，数据类型</p><p>为整型。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span>FUNCTION<span style=color:#bbb> </span><span style=color:#00a000>count_by_id</span>(dept_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>RETURNS<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>LANGUAGE<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>NOT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DETERMINISTIC</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>READS</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>DATA<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>SECURITY<span style=color:#bbb> </span>DEFINER<span style=color:#bbb> </span>COMMENT<span style=color:#bbb> </span><span style=color:#b44>&#39;查询部门平均工资&#39;</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>RETURN</span><span style=color:#bbb> </span>(<span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>COUNT</span>(<span style=color:#666>*</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>department_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>dept_id);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 调用:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>dept_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>50</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>count_by_id</span>(<span style=color:#666>@</span>dept_id);<span style=color:#bbb>
</span></span></span></code></pre></div><p>注意：</p><p>若在创建存储函数中报错“you might want to use the less safe log_bin_trust_function_creators variable”，有两种处理方法:</p><ul><li><p>方式1：</p><p>加上必要的函数特性“[NOT] DETERMINISTIC”和“{CONTAINS SQL | NO SQL | READS SQL DATA |MODIFIES SQL DATA}”</p></li><li><p>方式2：</p></li></ul><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>mysql&gt; SET GLOBAL log_bin_trust_function_creators = 1;
</span></span></code></pre></div><h3 id=53对比存储过程和存储函数>5.3、对比存储过程和存储函数</h3><table><thead><tr><th></th><th>关键字</th><th>语法</th><th>返回值</th><th>应用场景</th></tr></thead><tbody><tr><td>存储过程</td><td>PROCEDURE</td><td>CALL 存储过程()</td><td>理解为有0个或多个</td><td>一般用于更新</td></tr><tr><td>存储函数</td><td>FUNCTION</td><td>SELECT 函数()</td><td>只能是一个</td><td>一般用于查询结果为一个值并返回时</td></tr></tbody></table><h3 id=54存储过程和函数的查看修改删除>5.4、存储过程和函数的查看、修改、删除</h3><p>1）查看</p><p>创建完之后，怎么知道我们创建的存储过程、存储函数是否成功了呢?</p><p>MySQL存储了存储过程和函数的状态信息，用户可以使用SHOW STATUS语句或SHOW CREATE语句来查 看，也可直接从系统的information_schema数据库中查询。这里介绍3种方法。</p><ol><li><strong>使用</strong>SHOW CREATE<strong>语句查看存储过程和函数的创建信息</strong></li></ol><p>基本语法结构如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span>{</span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>FUNCTION<span>}</span><span style=color:#bbb> </span><span>存储过程名或函数名</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>举例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span>FUNCTION<span style=color:#bbb> </span>test_db.CountProc<span style=color:#bbb> </span><span>\</span>G<span style=color:#bbb>
</span></span></span></code></pre></div><ol start=2><li><strong>使用</strong>SHOW STATUS<strong>语句查看存储过程和函数的状态信息</strong></li></ol><p>基本语法结构如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span>{</span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>FUNCTION<span>}</span><span style=color:#bbb> </span>STATUS<span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;pattern&#39;</span>]<span style=color:#bbb>
</span></span></span></code></pre></div><p>这个语句返回子程序的特征，如数据库、名字、类型、创建者及创建和修改日期。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span>STATUS<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;SELECT%&#39;</span><span style=color:#bbb> </span><span>\</span>G<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>***************************</span><span style=color:#bbb> </span><span style=color:#666>1</span>.<span style=color:#bbb> </span>row<span style=color:#bbb> </span><span style=color:#666>***************************</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                  </span>Db:<span style=color:#bbb> </span>test_db<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>Name:<span style=color:#bbb> </span>SelectAllData<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>                </span>Type:<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>             </span>Definer:<span style=color:#bbb> </span>root<span style=color:#666>@</span>localhost<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>            </span>Modified:<span style=color:#bbb> </span><span style=color:#666>2021</span><span style=color:#666>-</span><span style=color:#666>10</span><span style=color:#666>-</span><span style=color:#666>16</span><span style=color:#bbb> </span><span style=color:#666>15</span>:<span style=color:#666>55</span>:<span style=color:#666>07</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>             </span>Created:<span style=color:#bbb> </span><span style=color:#666>2021</span><span style=color:#666>-</span><span style=color:#666>10</span><span style=color:#666>-</span><span style=color:#666>16</span><span style=color:#bbb> </span><span style=color:#666>15</span>:<span style=color:#666>55</span>:<span style=color:#666>07</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>       </span>Security_type:<span style=color:#bbb> </span>DEFINER<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>             </span>Comment:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>character_set_client:<span style=color:#bbb> </span>utf8mb4<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>collation_connection:<span style=color:#bbb> </span>utf8mb4_general_ci<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>  </span><span style=color:#a2f;font-weight:700>Database</span><span style=color:#bbb> </span>Collation:<span style=color:#bbb> </span>utf8mb4_general_ci<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>1</span><span style=color:#bbb> </span>row<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>in</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>set</span><span style=color:#bbb> </span>(<span style=color:#666>0</span>.<span style=color:#666>00</span><span style=color:#bbb> </span>sec)<span style=color:#bbb>
</span></span></span></code></pre></div><ol start=3><li><strong>从</strong>information_schema.Routines<strong>表中查看存储过程和函数的信息</strong></li></ol><p>MySQL中存储过程和函数的信息存储在information_schema数据库下的Routines表中。可以通过查询该表的记录来查询存储过程和函数的信息。其基本语法形式如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>information_schema.Routines<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>ROUTINE_NAME<span style=color:#666>=</span><span style=color:#b44>&#39;存储过程或函数的名&#39;</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>ROUTINE_TYPE<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span>{</span><span style=color:#b44>&#39;PROCEDURE|FUNCTION&#39;</span><span>}</span>];<span style=color:#bbb>
</span></span></span></code></pre></div><p>说明：如果在MySQL数据库中存在存储过程和函数名称相同的情况，最好指定ROUTINE_TYPE查询条件来 指明查询的是存储过程还是函数。</p><p>举例：从Routines表中查询名称为CountProc的存储函数的信息，代码如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>information_schema.Routines<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>ROUTINE_NAME<span style=color:#666>=</span><span style=color:#b44>&#39;count_by_id&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>ROUTINE_TYPE<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;FUNCTION&#39;</span><span style=color:#bbb> </span><span>\</span>G<span style=color:#bbb>
</span></span></span></code></pre></div><p>2）修改</p><p>修改存储过程或函数，不影响存储过程或函数功能，只是修改相关特性。使用ALTER语句实现。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span>{</span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>FUNCTION<span>}</span><span style=color:#bbb> </span><span>存储过程或函数的名</span><span style=color:#bbb> </span>[characteristic<span style=color:#bbb> </span>...]<span style=color:#bbb>
</span></span></span></code></pre></div><p>其中，characteristic指定存储过程或函数的特性，其取值信息与创建存储过程、函数时的取值信息略有不同。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span>{</span><span style=color:#bbb> </span>CONTAINS<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>NO<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>READS</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>DATA<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>MODIFIES</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>DATA<span style=color:#bbb> </span><span>}</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>SECURITY<span style=color:#bbb> </span><span>{</span><span style=color:#bbb> </span>DEFINER<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>INVOKER<span style=color:#bbb> </span><span>}</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb> </span>COMMENT<span style=color:#bbb> </span><span style=color:#b44>&#39;string&#39;</span><span style=color:#bbb>
</span></span></span></code></pre></div><ul><li><p>CONTAINS SQL ，表示子程序包含SQL语句，但不包含读或写数据的语句。</p></li><li><p>NO SQL ，表示子程序中不包含SQL语句。</p></li><li><p>READS SQL DATA ，表示子程序中包含读数据的语句。</p></li><li><p>MODIFIES SQL DATA ，表示子程序中包含写数据的语句。</p></li><li><p>SQL SECURITY { DEFINER | INVOKER } ，指明谁有权限来执行。</p><ul><li>DEFINER，表示只有定义者自己才能够执行</li><li>INVOKER，表示调用者可以执行</li></ul></li><li><p>COMMENT &lsquo;string&rsquo;，表示注释信息</p></li></ul><p>举例1：</p><p>修改存储过程CountProc的定义。将读写权限改为MODIFIES SQL DATA，并指明调用者可以执行，代码如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span>CountProc<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>MODIFIES</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>DATA<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>SECURITY<span style=color:#bbb> </span>INVOKER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>查询修改后的信息：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>specific_name,sql_data_access,security_type<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>information_schema.<span style=color:#666>`</span>ROUTINES<span style=color:#666>`</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>routine_name<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;CountProc&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>routine_type<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;PROCEDURE&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>结果显示，存储过程修改成功。从查询的结果可以看出，访问数据的权限(SQL_DATA_ ACCESS)已经变 成MODIFIES SQL DATA，安全类型(SECURITY_TYPE)已经变成INVOKER。</p><p>举例2：</p><p>修改存储函数CountProc的定义。将读写权限改为READS SQL DATA，并加上注释信息“FIND NAME”，代码如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>ALTER</span><span style=color:#bbb> </span>FUNCTION<span style=color:#bbb> </span>CountProc<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>READS</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQL</span><span style=color:#bbb> </span>DATA<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>COMMENT<span style=color:#bbb> </span><span style=color:#b44>&#39;FIND NAME&#39;</span><span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>存储函数修改成功。从查询的结果可以看出，访问数据的权限（SQL_DATA_ACCESS）已经变成READS SQL DATA，函数注释（ROUTINE_COMMENT）已经变成FIND NAME。</p><p>3）删除</p><p>删除存储过程和函数，可以使用DROP语句，其语法结构如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DROP</span><span style=color:#bbb> </span><span>{</span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span>FUNCTION<span>}</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>EXISTS</span>]<span style=color:#bbb> </span><span>存储过程或函数的名</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>IF EXISTS:如果程序或函数不存储，它可以防止发生错误，产生一个用SHOW WARNINGS查看的警告。</p><p>举例:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DROP</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span>CountProc;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DROP</span><span style=color:#bbb> </span>FUNCTION<span style=color:#bbb> </span>CountProc;<span style=color:#bbb>
</span></span></span></code></pre></div><p>5.5、存储过程使用的争议</p><p>尽管存储过程有诸多优点，但是对于存储过程的使用， <strong>一直都存在着很多争议</strong> ，比如有些公司对于大型 项目要求使用存储过程，而有些公司在手册中明确禁止使用存储过程，为什么这些公司对存储过程的使 用需求差别这么大呢?</p><p><strong>优点</strong>：</p><p>1**、存储过程可以一次编译多次使用。** 存储过程只在创建时进行编译，之后的使用都不需要重新编译，这就提升了 SQL 的执行效率。</p><p>2**、可以减少开发工作量。**将代码封装成模块，实际上是编程的核心思想之一，这样可以把复杂的问题拆解成不同的模块，然后模块之间可以重复使用 ，在减少开发工作量的同时，还能保证代码的结构清晰。</p><p>3**、存储过程的安全性强。**我们在设定存储过程的时候可以设置对用户的使用权限 ，这样就和视图一样具有较强的安全性。</p><p>4**、可以减少网络传输量。** 因为代码封装到存储过程中，每次使用只需要调用存储过程即可，这样就减少了网络传输量。</p><p>5**、良好的封装性。**在进行相对复杂的数据库操作时，原本需要使用一条一条的 SQL 语句，可能要连接 多次数据库才能完成的操作，现在变成了一次存储过程，只需要 连接一次即可 。</p><p><strong>缺点</strong>：</p><p>基于上面这些优点，不少大公司都要求大型项目使用存储过程，比如微软、IBM 等公司。但是国内的阿里并不推荐开发人员使用存储过程，这是为什么呢?</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>【阿里开发规范】
</span></span><span style=display:flex><span>【强制】禁止使用存储过程，存储过程难以调试和扩展，更没有移植性。
</span></span></code></pre></div><p>存储过程虽然有诸如上面的好处，但缺点也是很明显的。</p><p>1**、可移植性差。**</p><p>存储过程不能跨数据库移植，比如在 MySQL、Oracle 和 SQL Server 里编写的存储过程，在换成其他数据库时都需要重新编写。</p><p>2**、调试困难。**</p><p>只有少数 DBMS 支持存储过程的调试。对于复杂的存储过程来说，开发和维护都不容易。虽然也有一些第三方工具可以对存储过程进行调试，但要收费。</p><p>3**、存储过程的版本管理很困难。**</p><p>比如数据表索引发生变化了，可能会导致存储过程失效。我们在开发软件的时候往往需要进行版本管理，但是存储过程本身没有版本控制，版本迭代更新的时候很麻烦。</p><p>4**、它不适合高并发的场景。**</p><p>高并发的场景需要减少数据库的压力，有时数据库会采用分库分表的方 式，而且对可扩展性要求很高，在这种情况下，存储过程会变得难以维护， 增加数据库的压力 ，显然就不适用了。</p><p>小结:</p><p>存储过程既方便，又有局限性。尽管不同的公司对存储过程的态度不一，但是对于我们开发人员来说，
不论怎样，掌握存储过程都是必备的技能之一。</p></div><footer class=post-footer><div class=post-tags><a href=/tags/mysql rel=tag title=MySql>#MySql#</a>
<a href=/tags/sql rel=tag title=Sql>#Sql#</a></div><div class=addthis_inline_share_toolbox></div><div class=post-nav><div class=article-copyright><div class=article-copyright-img><img src=/img/qq_qrcode.png width=129px height=129px><div style=text-align:center>QQ扫一扫交流</div></div><div class=article-copyright-info><p><span>标题：</span>MySql基础（三）</p><p><span>链接：</span>https://zhang4014439175.github.io/post/mysql%E4%B8%89/</p><p><span>作者：</span>凡梦星尘</p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div><button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");qr.style.display==="none"?qr.style.display="block":qr.style.display="none"'>
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/img/ali-pay.png alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://zhang4014439175.github.io/post/%E5%8F%8D%E5%B0%84/ rel=next title=Java反射机制><i class="fa fa-chevron-left"></i> Java反射机制</a></div><div class="post-nav-prev post-nav-item"><a href=https://zhang4014439175.github.io/post/mysql%E4%BA%8C/ rel=prev title=MySql基础（二）>MySql基础（二）
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/img/avatar.png alt=凡梦星尘><p class=site-author-name itemprop=name>凡梦星尘</p><p class="site-description motion-element" itemprop=description>再平凡的人也有属于他自己的梦想!</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>29</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>12</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>33</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href=https://github.com/elkan1788/ target=_blank title=GitHub><i class="fa fa-fw fa-github"></i>
GitHub</a></span>
<span class=links-of-author-item><a href=https://www.zhihu.com/people/fan-meng-xing-chen-1 target=_blank title=知乎><i class="fa fa-fw fa-globe"></i>
知乎</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class=links-of-blogroll-title><i class="fa fa-fw fa-globe"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://nutzam.com/ title=Nutz target=_blank>Nutz</a></li><li class=links-of-blogroll-item><a href=https://jfinal.com/ title=JFinal target=_blank>JFinal</a></li><li class=links-of-blogroll-item><a href=http://wendal.net/ title=Wendal target=_blank>Wendal</a></li><li class=links-of-blogroll-item><a href=https://www.liaoxuefeng.com/ title=廖雪峰 target=_blank>廖雪峰</a></li></ul></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/java>Java
<sup>15</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/spring>Spring
<sup>7</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%A1%86%E6%9E%B6>框架
<sup>7</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/mysql>Mysql
<sup>5</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/sql>SQL
<sup>5</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/docker>Docker
<sup>4</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF>容器化技术
<sup>4</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/jvm>Jvm
<sup>2</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/mybatis>Mybatis
<sup>2</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/rabbitmq>Rabbitmq
<sup>2</sup></a></li></ul></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>热爱生活与梦想</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.96.0</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv><i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span></span>
<span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div><div class=license-info><span class=storage-info>Storage by
<a href=https://www.ucloud.cn/ style=font-weight:700 target=_blank>UCloud云存储</a></span>
<span class=separator-line>/</span>
<span class=license-num><a href=http://beian.miit.gov.cn target=_blank>粤ICP备18047355号</a></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//unpkg.com/jquery@2.1.4/dist/jquery.min.js></script>
<script type=text/javascript src=https://zhang4014439175.github.iojs/search.js></script>
<script type=text/javascript src=https://zhang4014439175.github.iojs/affix.js></script>
<script type=text/javascript>function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){var t=$("#content").height(),e=$(window).height(),n=t>e?t-e:$(document).height()-e;return n}function getScrollbarWidth(){var e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){var t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);var s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){var t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){var e=$(".header-inner").height(),t=parseInt($(".footer").outerHeight(!0),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}})}function initTOCDimension(){$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);var e,t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){var t=$(".header-inner").height()+10,n,s,e,o;$("#sidebar").css({'margin-top':t}).show(),n=parseInt($("#sidebar").css("margin-top")),s=parseInt($(".sidebar-inner").css("height")),e=n+s,o=$(".content-wrap").height(),o<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){var e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=//unpkg.com/imageviewer@1.1.0/dist/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script type=text/javascript>const locale={placeholder:"欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^"};$(function(){detectIE()>0?$.getScript(document.location.protocol+"//unpkg.com/@waline/client@1.6.0/dist/Waline.min.js",function(){new Waline({el:"#wcomments",visitor:!0,emoji:[],wordLimit:"200",uploadImage:!1,locale,requiredMeta:["nick","mail"],serverURL:"Your WalineSerURL",lang:"zh-cn"})}):$("#wcomments").html("抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。")})</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script>
<script>(function(){var e=document.createElement("script"),t,n=window.location.protocol.split(":")[0];n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>