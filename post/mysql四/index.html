<!doctype html><html lang=zh-cn dir=content/zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=content-security-policy content="upgrade-insecure-requests"><title>MySql基础（四） - 换个方向前进</title><meta name=keywords content="博客,程序员,架构师,思考,读书,笔记,技术,分享,大数据,产品"><meta name=author content="换个方向前进"><meta property="og:title" content="MySql基础（四）"><meta property="og:site_name" content="换个方向前进"><meta property="og:image" content="https://zhang4014439175.github.io/img/author.jpg"><meta name=title content="MySql基础（四） - 换个方向前进"><meta name=description content="Sample article showcasing basic String syntax."><link rel="shortcut icon" href=https://zhang4014439175.github.io/img/favicon.ico><link rel=apple-touch-icon href=https://zhang4014439175.github.io/img/apple-touch-icon.png><link rel=apple-touch-icon-precomposed href=https://zhang4014439175.github.io/img/apple-touch-icon.png><link href=//unpkg.com/font-awesome@4.7.0/css/font-awesome.min.css rel=stylesheet type=text/css><link href=//unpkg.com/imageviewer@1.1.0/dist/viewer.min.css rel=stylesheet><link href=https://zhang4014439175.github.io/css/main.css rel=stylesheet type=text/css><link href=https://zhang4014439175.github.io/css/syntax.css rel=stylesheet type=text/css></head><body itemscope itemtype=http://schema.org/WebPage lang=zh-hans><div class="container one-collumn sidebar-position-left page-home"><div class=headband></div><header id=header class=header itemscope itemtype=http://schema.org/WPHeader><div class=header-inner><div class=site-brand-container><div class=site-nav-toggle><div class=toggle role=button style=opacity:1;top:0><span class=toggle-line></span>
<span class=toggle-line></span>
<span class=toggle-line></span></div></div><div class=site-meta><div class=custom-logo-site-title><a href=/ class=brand rel=start><span class=logo-line-before><i></i></span>
<span class=site-title>换个方向前进</span>
<span class=logo-line-after><i></i></span></a></div><p class=site-subtitle>愿每个目标坚定的自己，都能在未来无惧内卷、自信昂扬!</p></div><div class=site-nav-right><div class="toggle popup-trigger" style=opacity:1;top:0><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class=site-nav><ul id=menu class=menu><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-home"></i><br>首页</a></li><li class="menu-item menu-item-active"><a href=/post rel=section><i class="menu-item-icon fa fa-fw fa-archive"></i><br>分类</a></li><li class=menu-item><a href=/about.html rel=section><i class="menu-item-icon fa fa-fw fa-user"></i><br>关于我的</a></li><li class=menu-item><a href=/ rel=section><i class="menu-item-icon fa fa-fw fa-heartbeat"></i><br>公益网站</a></li><li class="menu-item menu-item-search"><a href=javascript:; class=popup-trigger><i class="menu-item-icon fa fa-search fa-fw"></i><br>搜索</a></li></ul><div class=site-search><div class="popup search-popup local-search-popup"><div class="local-search-header clearfix"><span class=search-icon><i class="fa fa-search"></i></span>
<span class=popup-btn-close><i class="fa fa-times-circle"></i></span><div class=local-search-input-wrapper><input autocomplete=off placeholder=搜索关键字... spellcheck=false type=text id=local-search-input autocapitalize=none autocorrect=off></div></div><div id=local-search-result></div></div></div></nav></div></header><main id=main class=main><div class=main-inner><div class=content-wrap><div id=content class=content><section id=posts class=posts-expand><article class="post post-type-normal" itemscope itemtype=http://schema.org/Article><header class=post-header><h1 class=post-title itemprop="name headline"><a class=post-title-link href=https://zhang4014439175.github.io/post/mysql%E5%9B%9B/ itemprop=url>MySql基础（四）</a></h1><div class=post-meta><span class=post-pushdate><i class="fa fa-calendar-o fa-fw"></i>
<span class=post-meta-item-text>时间：</span>
<time itemprop=dateCreated datetime=2016-03-22 content="2021-06-13">2021-06-13</time></span>
<span class=post-category><i class="fa fa-folder-o fa-fw"></i>
<span class=post-meta-item-text>分类：</span>
<span itemprop=about itemscope itemtype=https://schema.org/Thing><a class=post-category-a href=/categories/mysql itemprop=url rel=index><span itemprop=name>MySql</span></a>
&nbsp;</span></span>
<span class=post-wordcount><i class="fa fa-file-word-o fa-fw"></i>
<span class=post-meta-item-text>字数：</span>
<span class=leancloud-world-count>10943 字</span></span>
<span class=post-readtime><i class="fa fa-eye fa-fw"></i>
<span class=post-meta-item-text>阅读：</span>
<span class=leancloud-view-count>22分钟</span></span>
<span id=/post/mysql%E5%9B%9B/ class="leancloud_visitors post-visitor" data-flag-title=MySql基础（四）><i class="fa fa-binoculars fa-fw"></i>
<span class=post-meta-item-text>阅读次数：</span>
<span class=leancloud-visitors-count></span></span></div></header><div class=post-body itemprop=articleBody><p>        MySQL是一种关系型数据库管理系统，关系数据库将数据保存在不同的表中，而不是将所有数据放在一个大仓库内，这样就增加了速度并提高了灵活性。MySQL所使用的 SQL 语言是用于访问数据库的最常用标准化语言。MySQL 软件采用了双授权政策，分为社区版和商业版，由于其体积小、速度快、总体拥有成本低，尤其是开放源码这一特点，一般中小型网站的开发都选择 MySQL 作为网站数据库。</p><h2 id=一变量>一、变量</h2><p>在MySQL数据库的存储过程和函数中，可以使用变量来存储查询或计算的中间结果数据，或者输出最终</p><p>的结果数据。
在 MySQL 数据库中，变量分为<strong>系统变量</strong>以及<strong>用户自定义变量</strong>。</p><h2 id=1系统变量>1、系统变量</h2><p>变量由系统定义，不是用户定义，属于 层面。启动MySQL服务，生成MySQL服务实例期间， MySQL将为MySQL服务器内存中的系统变量赋值，这些系统变量定义了当前MySQL服务实例的属性、特 征。这些系统变量的值要么是 的默认值，要么是 (例如my.ini等)中的参数 值。大家可以通过网址https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html查看MySQL文档的系统变量。</p><p>系统变量分为全局系统变量(需要添加 关键字)以及会话系统变量(需要添加 关键 字)，有时也把全局系统变量简称为全局变量，有时也把会话系统变量称为local变量。 **如果不写，默认会话级别。**静态变量(在 MySQL 服务实例运行期间它们的值不能使用 set 动态修改)属于特殊的全局系 统变量。</p><p>每一个MySQL客户机成功连接MySQL服务器后，都会产生与之对应的会话。会话期间，MySQL服务实例会在MySQL服务器内存中生成与该会话对应的会话系统变量，这些会话系统变量的初始值是全局系统变 量值的复制。</p><ul><li><p>全局系统变量针对于所有会话(连接)有效，但不能跨重启</p></li><li><p>会话1对某个全局系统变量值的修改会导致会话2中同一个全局系统变量值的修改。</p></li></ul><p>1）在MySQL中有些系统变量只能是全局的，例如：</p><p>​ max_connections 用于限制服务器的最大连接数;</p><p>2）有些系统变量作用域既可以是全局又可以是会话，例如：</p><p>​ character_set_client 用于设置客户端的字符集</p><p>3）有些系 统变量的作用域只能是当前会话，例如：</p><p>​ pseudo_thread_id 用于标记当前会话的 MySQL 连接 ID。</p><h3 id=11查看系统变量>1.1、查看系统变量</h3><p><strong>查看所有或部分系统变量</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#查看所有全局变量
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span>GLOBAL<span style=color:#bbb> </span>VARIABLES;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#查看所有会话变量
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span>SESSION<span style=color:#bbb> </span>VARIABLES;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span>或</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span>VARIABLES;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#查看满足条件的部分系统变量。
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span>GLOBAL<span style=color:#bbb> </span>VARIABLES<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;%标识符%&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#查看满足条件的部分会话变量
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span>SESSION<span style=color:#bbb> </span>VARIABLES<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;%标识符%&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SHOW</span><span style=color:#bbb> </span>GLOBAL<span style=color:#bbb> </span>VARIABLES<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LIKE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;admin_%&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=12查看指定系统变量>1.2、查看指定系统变量</h3><p>作为 MySQL 编码规范，MySQL 中的系统变量以 两个“@” 开头，其中“@@global”仅用于标记全局系统变 量，“@@session”仅用于标记会话系统变量。“@@”首先标记会话系统变量，如果会话系统变量不存在， 则标记全局系统变量。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#查看指定的系统变量的值 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@@</span>global.<span>变量名</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#查看指定的会话变量的值 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@@</span>session.<span>变量名</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#或者
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@@</span><span>变量名</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>修改系统变量的值</strong></p><p>有些时候，数据库管理员需要修改系统变量的默认值，以便修改当前会话或者MySQL服务实例的属性、 特征。具体方法:</p><p>方式1：修改MySQL 配置文件 ，继而修改MySQL系统变量的值(该方法需要重启MySQL服务)</p><p>方式2：在MySQL服务运行期间，使用“set”命令重新设置系统变量的值</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#为某个系统变量赋值
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#方式1:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@@</span>global.<span>变量名</span><span style=color:#666>=</span><span>变量值</span>;<span style=color:#bbb> </span><span style=color:#080;font-style:italic>#方式2:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>GLOBAL<span style=color:#bbb> </span><span>变量名</span><span style=color:#666>=</span><span>变量值</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#为某个会话变量赋值
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic>#方式1:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@@</span>session.<span>变量名</span><span style=color:#666>=</span><span>变量值</span>;<span style=color:#bbb> </span><span style=color:#080;font-style:italic>#方式2:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>SESSION<span style=color:#bbb> </span><span>变量名</span><span style=color:#666>=</span><span>变量值</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>举例</strong>：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@@</span>global.autocommit;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>GLOBAL<span style=color:#bbb> </span>autocommit<span style=color:#666>=</span><span style=color:#666>0</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@@</span>session.tx_isolation;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@@</span>session.tx_isolation<span style=color:#666>=</span><span style=color:#b44>&#39;read-uncommitted&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>GLOBAL<span style=color:#bbb> </span>max_connections<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1000</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@@</span>global.max_connections;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=2用户变量>2、用户变量</h2><h3 id=21用户变量分类>2.1、用户变量分类</h3><p>用户变量是用户自己定义的，作为 MySQL 编码规范，MySQL 中的用户变量以 一个“@” 开头。根据作用 范围不同，又分为 会话用户变量 和 局部变量 。</p><ul><li>会话用户变量：作用域和会话变量一样，只对 当前连接 会话有效。</li><li>局部变量：只在 BEGIN 和 END 语句块中有效。局部变量只能在 存储过程和函数 中使用。</li></ul><h3 id=22会话用户变量>2.2、会话用户变量</h3><p>变量的定义</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#方式1:“=”或“:=” 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span><span>用户变量</span><span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span>值</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span><span>用户变量</span><span style=color:#bbb> </span>:<span style=color:#666>=</span><span style=color:#bbb> </span><span>值</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#方式2:“:=” 或 INTO关键字
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span><span>用户变量</span><span style=color:#bbb> </span>:<span style=color:#666>=</span><span style=color:#bbb> </span><span>表达式</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span><span>等子句</span>];<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span>表达式</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span><span style=color:#666>@</span><span>用户变量</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span><span>等子句</span>];<span style=color:#bbb>
</span></span></span></code></pre></div><p>查看用户变量的值 (查看、比较、运算等)</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span><span>用户变量</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>举例：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>a<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>a;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>num<span style=color:#bbb> </span>:<span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#00a000>COUNT</span>(<span style=color:#666>*</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>num;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>AVG</span>(salary)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span><span style=color:#666>@</span>avgsalary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>avgsalary;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>big;<span style=color:#bbb> </span><span style=color:#080;font-style:italic>#查看某个未声明的变量时，将得到NULL值
</span></span></span></code></pre></div><h3 id=23局部变量>2.3、局部变量</h3><p>定义：可以使用 DECLARE 语句定义一个局部变量</p><p>作用域：仅仅在定义它的 BEGIN &mldr; END 中有效</p><p>位置：只能放在 BEGIN &mldr; END 中，而且只能放在第一句</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#080;font-style:italic>#声明局部变量
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span>变量名</span><span style=color:#666>1</span><span style=color:#bbb> </span><span>变量数据类型</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span>变量默认值</span>];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span>变量名</span><span style=color:#666>2</span>,<span>变量名</span><span style=color:#666>3</span>,...<span style=color:#bbb> </span><span>变量数据类型</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span>变量默认值</span>];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#080;font-style:italic>#为局部变量赋值
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>		</span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span>变量名</span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span>值</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span>值</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span><span>变量名</span><span style=color:#666>2</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span><span>子句</span>];<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#080;font-style:italic>#查看局部变量的值
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span>变量</span><span style=color:#666>1</span>,<span>变量</span><span style=color:#666>2</span>,<span>变量</span><span style=color:#666>3</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb>
</span></span></span></code></pre></div><p>1）定义变量</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span>变量名</span><span style=color:#bbb> </span><span>类型</span><span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>default</span><span style=color:#bbb> </span><span>值</span>];<span style=color:#bbb> </span><span style=color:#080;font-style:italic># 如果没有DEFAULT子句，初始值为NULL
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span>举例</span>:<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>myparam<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#666>100</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>2）变量赋值</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span>方式</span><span style=color:#666>1</span><span>：一般用于赋简单的值</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> 		</span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span>变量名</span><span style=color:#666>=</span><span>值</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb> 		</span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span>变量名</span>:<span style=color:#666>=</span><span>值</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span>方式</span><span style=color:#666>2</span><span>：一般用于赋表中的字段值</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb> 		</span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span>字段名或表达式</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span><span>变量名</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span><span>表</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>3）使用变量（查看、比较、运算等）</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span>局部变量名</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例1：</p><p>声明局部变量，并分别赋值为employees表中employee_id为102的last_name和salary</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>set_value</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>emp_name<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>VARCHAR</span>(<span style=color:#666>25</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>sal<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>(<span style=color:#666>10</span>,<span style=color:#666>2</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>last_name,salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>emp_name,sal<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>102</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>emp_name,sal;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例2：</p><p>声明两个变量，求和并打印（分别使用会话用户变量、局部变量的方式实现）</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#方式1:使用用户变量 SET @m=1;
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>n<span style=color:#666>=</span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>sum<span style=color:#666>=@</span>m<span style=color:#666>+@</span>n;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>sum;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#方式2:使用局部变量 
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>add_value</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#080;font-style:italic>#局部变量
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>m<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#666>1</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>n<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#666>3</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>SUM<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>SUM<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>m<span style=color:#666>+</span>n;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>SUM;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例3：</p><p>创建存储过程“different_salary”查询某员工和他领导的薪资差距，并用IN参数emp_id接收员工 id，用OUT参数dif_salary输出薪资差距结果。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#声明 DELIMITER //
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>different_salary</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>emp_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>,<span style=color:#a2f;font-weight:700>OUT</span><span style=color:#bbb> </span>dif_salary<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#080;font-style:italic>#声明局部变量
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>emp_sal,mgr_sal<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#666>0</span>.<span style=color:#666>0</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>mgr_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>emp_sal<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>manager_id<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>mgr_id<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>mgr_sal<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>mgr_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>dif_salary<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>mgr_sal<span style=color:#bbb> </span><span style=color:#666>-</span><span style=color:#bbb> </span>emp_sal;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#调用
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>emp_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>102</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span style=color:#00a000>different_salary</span>(<span style=color:#666>@</span>emp_id,<span style=color:#666>@</span>diff_sal);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#查看
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>diff_sal;<span style=color:#bbb>
</span></span></span></code></pre></div><h3 id=24会话用户变量与局部变量>2.4、会话用户变量与局部变量</h3><table><thead><tr><th></th><th>作用域</th><th>定义位置</th><th>语法</th></tr></thead><tbody><tr><td>会话用户变量</td><td>当前会话</td><td>会话的任何地方</td><td>加@符号，不用指定类型</td></tr><tr><td>局部变量</td><td>定义它的BEGIN END中</td><td>BEGIN END的第一句话</td><td>一般不用加@,需要指定类型</td></tr></tbody></table><h1 id=二定义条件与处理程序>二、定义条件与处理程序</h1><p>定义条件 是事先定义程序执行过程中可能遇到的问题， 处理程序定义了在遇到问题时应当采取的处理方式，并且保证存储过程或函数在遇到警告或错误时能继续执行。这样可以增强存储程序处理问题的能力，避免程序异常停止运行。</p><p>说明：定义条件和处理程序在存储过程、存储函数中都是支持的。</p><h2 id=1案例分析>1、案例分析</h2><p>创建一个名称为“UpdateDataNoCondition”的存储过程。代码如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>UpdateDataNoCondition</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>email<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#800>NULL</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>last_name<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;Abel&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>2</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>email<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;aabbel&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>last_name<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;Abel&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>3</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 调用存储过程:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span style=color:#00a000>UpdateDataNoCondition</span>();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>ERROR<span style=color:#bbb> </span><span style=color:#666>1048</span><span style=color:#bbb> </span>(<span style=color:#666>23000</span>):<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>Column</span><span style=color:#bbb> </span><span style=color:#b44>&#39;email&#39;</span><span style=color:#bbb> </span>cannot<span style=color:#bbb> </span>be<span style=color:#bbb> </span><span style=color:#800>null</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>x;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>+------+</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb>		</span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>+------+</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb>		</span><span style=color:#666>1</span><span style=color:#bbb>	 </span><span style=color:#666>|</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>+------+</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>1</span><span style=color:#bbb> </span>row<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>in</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>set</span><span style=color:#bbb> </span>(<span style=color:#666>0</span>.<span style=color:#666>00</span><span style=color:#bbb> </span>sec)<span style=color:#bbb>
</span></span></span></code></pre></div><p>可以看到，此时@x变量的值为1。结合创建存储过程的SQL语句代码可以得出：在存储过程中未定义条件和处理程序，且当存储过程中执行的SQL语句报错时，MySQL数据库会抛出错误，并退出当前SQL逻辑， 不再向下继续执行。</p><h2 id=2定义条件>2、定义条件</h2><p>定义条件就是给MySQL中的错误码命名，这有助于存储的程序代码更清晰。它将一个 错误名字 和 指定的</p><p>错误条件 关联起来。这个名字可以随后被用在定义处理程序的 DECLARE HANDLER 语句中。</p><p>定义条件使用DECLARE语句，语法格式如下：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span>错误名称</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONDITION</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span>错误码</span>(<span>或错误条件</span>)<span style=color:#bbb>
</span></span></span></code></pre></div><p>错误码的说明:</p><ul><li><p>MySQL_error_code 和 sqlstate_value 都可以表示MySQL的错误。</p><ul><li>MySQL_error_code是数值类型错误代码。</li><li>sqlstate_value是长度为5的字符串类型错误代码。</li></ul></li><li><p>例如，在ERROR 1418 (HY000)中，1418是MySQL_error_code，&lsquo;HY000&rsquo;是sqlstate_value。</p></li><li><p>例如，在ERROR 1142(42000)中，1142是MySQL_error_code，&lsquo;42000&rsquo;是sqlstate_value。</p></li></ul><p>举例1：定义“Field_Not_Be_NULL”错误名与MySQL中违反非空约束的错误类型是“ERROR 1048 (23000)”对应。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#使用MySQL_error_code
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>Field_Not_Be_NULL<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONDITION</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#666>1048</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#使用sqlstate_value
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>Field_Not_Be_NULL<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONDITION</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQLSTATE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;23000&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>举例</strong>2**:**定义"ERROR 1148(42000)&ldquo;错误，名称为command_not_allowed。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#使用MySQL_error_code
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>command_not_allowed<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONDITION</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#666>1148</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#使用sqlstate_value
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>command_not_allowed<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONDITION</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQLSTATE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;42000&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=3定义处理程序>3、定义处理程序</h2><p>可以为SQL执行过程中发生的某种类型的错误定义特殊的处理程序。定义处理程序时，使用DECLARE语句的语法如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span>处理方式</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span>错误类型</span><span style=color:#bbb> </span><span>处理语句</span><span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>处理方式</strong>：处理方式有3个取值:CONTINUE、EXIT、UNDO。</p><p>CONTINUE： 表示遇到错误不处理，继续执行。
EXIT： 表示遇到错误马上退出。
UNDO： 表示遇到错误后撤回之前的操作。MySQL中暂时不支持这样的操作。</p><p><strong>错误类型</strong> (即条件)可以有如下取值:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>SQLSTATE ’字符串错误码‘：表示长度为5的sqlstate_value类型的错误代码;
</span></span><span style=display:flex><span>MySQL_error_code：			匹配数值类型错误代码;
</span></span><span style=display:flex><span>错误名称：							 表示DECLARE ... CONDITION定义的错误条件名称。
</span></span><span style=display:flex><span>SQLWARNING：						匹配所有以01开头的SQLSTATE错误代码;
</span></span><span style=display:flex><span>NOT FOUND：						匹配所有以02开头的SQLSTATE错误代码;
</span></span><span style=display:flex><span>SQLEXCEPTION：					匹配所有没有被SQLWARNING或NOT FOUND捕获的SQLSTATE错误代码;
</span></span></code></pre></div><p><strong>处理语句</strong>：</p><p>如果出现上述条件之一，则采用对应的处理方式，并执行指定的处理语句。语句可以是 像“ SET 变量 = 值 ”这样的简单语句，也可以是使用 BEGIN &mldr; END 编写的复合语句。</p><p>定义处理程序的几种方式，代码如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#方法1:捕获sqlstate_value
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONTINUE</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQLSTATE</span><span style=color:#bbb> </span><span style=color:#b44>&#39;42S02&#39;</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>info<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;NO_SUCH_TABLE&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#方法2:捕获mysql_error_value
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONTINUE</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#666>1146</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>info<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;NO_SUCH_TABLE&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#方法3:先定义条件，再调用
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>no_such_table<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONDITION</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#666>1146</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONTINUE</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span>NO_SUCH_TABLE<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>info<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;NO_SUCH_TABLE&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#方法4:使用SQLWARNING
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>EXIT</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQLWARNING</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>info<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;ERROR&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#方法5:使用NOT FOUND
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>EXIT</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>NOT</span><span style=color:#bbb> </span>FOUND<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>info<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;NO_SUCH_TABLE&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic>#方法6:使用SQLEXCEPTION
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>EXIT</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SQLEXCEPTION</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>info<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;ERROR&#39;</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=4案例解决>4、案例解决</h2><p>在存储过程中，定义处理程序，捕获sqlstate_value值，当遇到MySQL_error_code值为1048时，执行 CONTINUE操作，并且将@proc_value的值设置为-1。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>UpdateDataNoCondition</span>()<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>				</span><span style=color:#080;font-style:italic>#定义处理程序
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#bbb>				</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CONTINUE</span><span style=color:#bbb> </span>HANDLER<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FOR</span><span style=color:#bbb> </span><span style=color:#666>1048</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>proc_value<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>-</span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>				
</span></span></span><span style=display:flex><span><span style=color:#bbb>				</span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>				</span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>2</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>email<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;aabbel&#39;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>last_name<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#b44>&#39;Abel&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>3</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#080;font-style:italic># 调用过程:
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CALL</span><span style=color:#bbb> </span><span style=color:#00a000>UpdateDataWithCondition</span>();<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>Query<span style=color:#bbb> </span>OK,<span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb> </span>rows<span style=color:#bbb> </span><span style=color:#00a000>affected</span><span style=color:#bbb> </span>(<span style=color:#666>0</span>.<span style=color:#666>01</span><span style=color:#bbb> </span>sec)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>mysql<span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#666>@</span>x,<span style=color:#666>@</span>proc_value;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>+------+-------------+</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb> 	</span><span style=color:#666>@</span>x<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> </span><span style=color:#666>@</span>proc_value<span style=color:#bbb> </span><span style=color:#666>|</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>+------+-------------+</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>|</span><span style=color:#bbb>		</span><span style=color:#666>3</span><span style=color:#bbb>	 </span><span style=color:#666>|</span><span style=color:#bbb> 			</span><span style=color:#666>-</span><span style=color:#666>1</span><span style=color:#bbb>		 </span><span style=color:#666>|</span><span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>+------+-------------+</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#666>1</span><span style=color:#bbb> </span>row<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>in</span><span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>set</span><span style=color:#bbb> </span>(<span style=color:#666>0</span>.<span style=color:#666>00</span><span style=color:#bbb> </span>sec)<span style=color:#bbb>
</span></span></span></code></pre></div><h1 id=三流程控制>三、流程控制</h1><p>解决复杂问题不可能通过一个 SQL 语句完成，我们需要执行多个 SQL 操作。流程控制语句的作用就是控 制存储过程中 SQL 语句的执行顺序，是我们完成复杂操作必不可少的一部分。只要是执行的程序，流程 就分为三大类:</p><ul><li><p>顺序结构：程序从上往下依次执行</p></li><li><p>分支结构：程序按条件进行选择执行，从两条或多条路径中选择一条执行</p></li><li><p>循环结构：程序满足一定条件下，重复执行一组语句</p></li></ul><p>针对于MySQL 的流程控制语句主要有 3 类。注意:只能用于存储程序。</p><ul><li><p>条件判断语句：IF 语句和 CASE 语句</p></li><li><p>循环语句：LOOP、WHILE 和 REPEAT 语句</p></li><li><p>跳转语句：ITERATE 和 LEAVE 语句</p></li></ul><h2 id=1分支结构之-if>1、<strong>分支结构之</strong> IF</h2><p>IF 语句的语法结构是:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span><span>表达式</span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span>操作</span><span style=color:#666>1</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>[<span style=color:#a2f;font-weight:700>ELSEIF</span><span style=color:#bbb> </span><span>表达式</span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span>操作</span><span style=color:#666>2</span>]......<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>[<span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb> </span><span>操作</span>N]<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb>
</span></span></span></code></pre></div><p>根据表达式的结果为TRUE或FALSE执行相应的语句。这里“[]”中的内容是可选的。</p><p>特点:1 不同的表达式对应不同的操作 2 使用在begin end中</p><p>举例1：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span>val<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IS</span><span style=color:#bbb> </span><span style=color:#800>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is null&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is not null&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例2：</p><p>声明存储过程“update_salary_by_eid1”，定义IN参数emp_id，输入员工编号。判断该员工 薪资如果低于8000元并且入职时间超过5年，就涨薪500元;否则就不变。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>update_salary_by_eid1</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>emp_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>DATEDIFF</span>(<span style=color:#00a000>CURDATE</span>(),hire_date)<span style=color:#666>/</span><span style=color:#666>365</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#666>&lt;</span><span style=color:#bbb> </span><span style=color:#666>8000</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb> </span><span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span><span style=color:#666>500</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例3：</p><p>声明存储过程“update_salary_by_eid2”，定义IN参数emp_id，输入员工编号。判断该员工 薪资如果低于9000元并且入职时间超过5年，就涨薪500元;否则就涨薪100元。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>update_salary_by_eid2</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>emp_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>DATEDIFF</span>(<span style=color:#00a000>CURDATE</span>(),<span style=color:#bbb> </span>hire_date)<span style=color:#666>/</span><span style=color:#666>365</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#666>&lt;</span><span style=color:#bbb> </span><span style=color:#666>8000</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb> </span><span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#666>5</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>				</span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span><span style=color:#666>500</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>				</span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span><span style=color:#666>100</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例4：</p><p>声明存储过程“update_salary_by_eid3”，定义IN参数emp_id，输入员工编号。</p><p>判断该员工 薪资如果低于9000元，就更新薪资为9000元;</p><p>薪资如果大于等于9000元且低于10000的，但是奖金 比例为NULL的，就更新奖金比例为0.01;</p><p>其他的涨薪100元。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>     </span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>update_salary_by_eid3</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>emp_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>     </span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>         </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>         </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>bonus<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DECIMAL</span>(<span style=color:#666>3</span>,<span style=color:#666>2</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>         </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>         </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>commission_pct<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>bonus<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>         </span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#666>&lt;</span><span style=color:#bbb> </span><span style=color:#666>9000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>							</span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>9000</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>				 </span><span style=color:#a2f;font-weight:700>ELSEIF</span><span style=color:#bbb> </span>emp_salary<span style=color:#bbb> </span><span style=color:#666>&lt;</span><span style=color:#bbb> </span><span style=color:#666>10000</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>bonus<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IS</span><span style=color:#bbb> </span><span style=color:#800>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        			</span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>commission_pct<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span><span style=color:#666>0</span>.<span style=color:#666>01</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    		 </span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        			</span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span><span style=color:#666>100</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>				 </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>     </span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=2分支结构之-case>2、<strong>分支结构之</strong> CASE</h2><p>CASE 语句的语法结构1：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#情况一:类似于switch
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>CASE</span><span style=color:#bbb> </span><span>表达式</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span>值</span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span>结果</span><span style=color:#666>1</span><span>或语句</span><span style=color:#666>1</span>(<span>如果是语句，需要加分号</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span>值</span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span>结果</span><span style=color:#666>2</span><span>或语句</span><span style=color:#666>2</span>(<span>如果是语句，需要加分号</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb> </span><span>结果</span><span style=color:#00a000>n或语句n</span>(<span>如果是语句，需要加分号</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>case</span>](<span>如果是放在</span>begin<span style=color:#bbb> </span>end中需要加上case<span>，如果放在</span>select后面不需要)<span style=color:#bbb>
</span></span></span></code></pre></div><p>CASE 语句的语法结构2：</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#080;font-style:italic>#情况二:类似于多重if
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span>条件</span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span>结果</span><span style=color:#666>1</span><span>或语句</span><span style=color:#666>1</span>(<span>如果是语句，需要加分号</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span>条件</span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span>结果</span><span style=color:#666>2</span><span>或语句</span><span style=color:#666>2</span>(<span>如果是语句，需要加分号</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>...<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb> </span><span>结果</span><span style=color:#00a000>n或语句n</span>(<span>如果是语句，需要加分号</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span>[<span style=color:#a2f;font-weight:700>case</span>](<span>如果是放在</span>begin<span style=color:#bbb> </span>end中需要加上case<span>，如果放在</span>select后面不需要)<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>举例</strong>1： 使用CASE流程控制语句的第1种格式，判断val值等于1、等于2，或者两者都不等。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CASE</span><span style=color:#bbb> </span>val<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>   </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is 1&#39;</span>;<span style=color:#bbb>    
</span></span></span><span style=display:flex><span><span style=color:#bbb>   </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is 2&#39;</span>;<span style=color:#bbb>    
</span></span></span><span style=display:flex><span><span style=color:#bbb>   </span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is not 1 or 2&#39;</span>;<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CASE</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>举例</strong>2**：** 使用CASE流程控制语句的第2种格式，判断val是否为空、小于0、大于0或者等于0。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span>val<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IS</span><span style=color:#bbb> </span><span style=color:#800>NULL</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is null&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span>val<span style=color:#bbb> </span><span style=color:#666>&lt;</span><span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is less than 0&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span>val<span style=color:#bbb> </span><span style=color:#666>&gt;</span><span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is greater than 0&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#b44>&#39;val is 0&#39;</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CASE</span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p><strong>举例</strong>3**：**声明存储过程“update_salary_by_eid4”，定义IN参数emp_id，输入员工编号。判断该员工 薪资如果低于9000元，就更新薪资为9000元;薪资大于等于9000元且低于10000的，但是奖金比例 为NULL的，就更新奖金比例为0.01;其他的涨薪100元。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>update_salary_by_eid4</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>emp_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>emp_sal<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>bonus<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DECIMAL</span>(<span style=color:#666>3</span>,<span style=color:#666>2</span>);<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>emp_sal<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>commission_pct<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>bonus<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>CASE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span>emp_sal<span style=color:#666>&lt;</span><span style=color:#666>9000</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span><span style=color:#666>9000</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span>emp_sal<span style=color:#666>&lt;</span><span style=color:#666>10000</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>AND</span><span style=color:#bbb> </span>bonus<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IS</span><span style=color:#bbb> </span><span style=color:#800>NULL</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>commission_pct<span style=color:#666>=</span><span style=color:#666>0</span>.<span style=color:#666>01</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span>salary<span style=color:#666>+</span><span style=color:#666>100</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CASE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例4：声明存储过程update_salary_by_eid5，定义IN参数emp_id，输入员工编号。判断该员工的 入职年限，如果是0年，薪资涨50;如果是1年，薪资涨100;如果是2年，薪资涨200;如果是3年， 薪资涨300;如果是4年，薪资涨400;其他的涨薪500。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>update_salary_by_eid5</span>(<span style=color:#a2f;font-weight:700>IN</span><span style=color:#bbb> </span>emp_id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>emp_sal<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>emp_sal<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>ROUND</span>(<span style=color:#00a000>DATEDIFF</span>(<span style=color:#00a000>CURDATE</span>(),hire_date)<span style=color:#666>/</span><span style=color:#666>365</span>)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>CASE</span><span style=color:#bbb> </span>hire_year<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#666>0</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span>salary<span style=color:#666>+</span><span style=color:#666>50</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#666>1</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span>salary<span style=color:#666>+</span><span style=color:#666>100</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#666>2</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span>salary<span style=color:#666>+</span><span style=color:#666>200</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#666>3</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span>salary<span style=color:#666>+</span><span style=color:#666>300</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>WHEN</span><span style=color:#bbb> </span><span style=color:#666>4</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span>salary<span style=color:#666>+</span><span style=color:#666>400</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>ELSE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#666>=</span>salary<span style=color:#666>+</span><span style=color:#666>500</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>WHERE</span><span style=color:#bbb> </span>employee_id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>emp_id;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>CASE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div><h2 id=3循环结构之loop>3、循环结构之LOOP</h2><p>LOOP循环语句用来重复执行某些语句。LOOP内的语句一直重复执行直到循环被退出(使用LEAVE子</p><p>句)，跳出循环过程。</p><p>LOOP语句的基本格式如下:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>[loop_label:]<span style=color:#bbb> 
</span></span></span><span style=display:flex><span><span style=color:#bbb>		</span><span style=color:#a2f;font-weight:700>LOOP</span><span style=color:#bbb> </span><span>循环执行的语句</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LOOP</span><span style=color:#bbb> </span>[loop_label]<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例1：</p><p>其中，loop_label表示LOOP语句的标注名称，该参数可以省略。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>id<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#666>0</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>add_loop:<span style=color:#a2f;font-weight:700>LOOP</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>id<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>id<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span>id<span style=color:#bbb> </span><span style=color:#666>&gt;=</span><span style=color:#bbb> </span><span style=color:#666>10</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LEAVE</span><span style=color:#bbb> </span>add_loop;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LOOP</span><span style=color:#bbb> </span>add_loop;<span style=color:#bbb>
</span></span></span></code></pre></div><p>举例2：</p><p>当市场环境变好时，公司为了奖励大家，决定给大家涨工资。声明存储过程 “update_salary_loop()”，声明OUT参数num，输出循环次数。存储过程中实现循环给大家涨薪，薪资涨为 原来的1.1倍。直到全公司的平均薪资达到12000结束。并统计循环次数。</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-mysql data-lang=mysql><span style=display:flex><span>DELIMITER<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span><span style=color:#a2f;font-weight:700>CREATE</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>PROCEDURE</span><span style=color:#bbb> </span><span style=color:#00a000>update_salary_loop</span>(<span style=color:#a2f;font-weight:700>OUT</span><span style=color:#bbb> </span>num<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span>)<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>BEGIN<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>avg_salary<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>DOUBLE</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>DECLARE</span><span style=color:#bbb> </span>loop_count<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>INT</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>DEFAULT</span><span style=color:#bbb> </span><span style=color:#666>0</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>AVG</span>(salary)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>avg_salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>label_loop:<span style=color:#a2f;font-weight:700>LOOP</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>IF</span><span style=color:#bbb> </span>avg_salary<span style=color:#bbb> </span><span style=color:#666>&gt;=</span><span style=color:#bbb> </span><span style=color:#666>12000</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>THEN</span><span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LEAVE</span><span style=color:#bbb> </span>label_loop;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>IF</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>UPDATE</span><span style=color:#bbb> </span>employees<span style=color:#bbb> </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>salary<span style=color:#bbb> </span><span style=color:#666>*</span><span style=color:#bbb> </span><span style=color:#666>1</span>.<span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>loop_count<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>loop_count<span style=color:#bbb> </span><span style=color:#666>+</span><span style=color:#bbb> </span><span style=color:#666>1</span>;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>        </span><span style=color:#a2f;font-weight:700>SELECT</span><span style=color:#bbb> </span><span style=color:#00a000>AVG</span>(salary)<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>INTO</span><span style=color:#bbb> </span>avg_salary<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>FROM</span><span style=color:#bbb> </span>employees;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span>END<span style=color:#bbb> </span><span style=color:#a2f;font-weight:700>LOOP</span><span style=color:#bbb> </span>label_loop;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb>    </span><span style=color:#0b0;font-weight:700>SET</span><span style=color:#bbb> </span>num<span style=color:#bbb> </span><span style=color:#666>=</span><span style=color:#bbb> </span>loop_count;<span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>END<span style=color:#bbb> </span><span style=color:#666>//</span><span style=color:#bbb>
</span></span></span><span style=display:flex><span><span style=color:#bbb></span>DELIMITER<span style=color:#bbb> </span>;<span style=color:#bbb>
</span></span></span></code></pre></div></div><footer class=post-footer><div class=post-tags><a href=/tags/mysql rel=tag title=MySql>#MySql#</a>
<a href=/tags/sql rel=tag title=Sql>#Sql#</a></div><div class=addthis_inline_share_toolbox></div><div class=post-nav><div class=article-copyright><div class=article-copyright-img><img src=/img/qq_qrcode.png width=129px height=129px><div style=text-align:center>QQ扫一扫交流</div></div><div class=article-copyright-info><p><span>标题：</span>MySql基础（四）</p><p><span>链接：</span>https://zhang4014439175.github.io/post/mysql%E5%9B%9B/</p><p><span>作者：</span>换个方向前进</p><p><span>声明： </span>本博客文章除特别声明外，均采用 <a href=https://creativecommons.org/licenses/by-nc-sa/3.0/ target=_blank style=text-decoration:underline>CC BY-NC-SA 3.0</a>许可协议，转载请注明出处！</p></div></div><div class=clear></div></div><div class=reward-qr-info><div>创作实属不易，如有帮助，那就打赏博主些许茶钱吧 ^_^</div><button id=rewardButton disable=enable onclick='var qr=document.getElementById("QR");qr.style.display==="none"?qr.style.display="block":qr.style.display="none"'>
<span>赏</span></button><div id=QR style=display:none><div id=wechat style=display:inline-block><img id=wechat_qr src=/img/wechat-pay.png alt="WeChat Pay"><p>微信打赏</p></div><div id=alipay style=display:inline-block><img id=alipay_qr src=/img/ali-pay.png alt=Alipay><p>支付宝打赏</p></div></div></div><div class=post-nav><div class="post-nav-next post-nav-item"><a href=https://zhang4014439175.github.io/post/%E5%8F%8D%E5%B0%84-%E5%86%85%E7%9C%81/ rel=next title=Java反射机制-内省(IntroSpector)><i class="fa fa-chevron-left"></i> Java反射机制-内省(IntroSpector)</a></div><div class="post-nav-prev post-nav-item"><a href=https://zhang4014439175.github.io/post/%E5%8F%8D%E5%B0%84/ rel=prev title=Java反射机制>Java反射机制
<i class="fa fa-chevron-right"></i></a></div></div><div id=wcomments></div></footer></article></section></div></div><div class=sidebar-toggle><div class=sidebar-toggle-line-wrap><span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
<span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside id=sidebar class=sidebar><div class=sidebar-inner><section class="site-overview sidebar-panel sidebar-panel-active"><div class="site-author motion-element" itemprop=author itemscope itemtype=http://schema.org/Person><img class=site-author-image itemprop=image src=/img/avatar.png alt=换个方向前进><p class=site-author-name itemprop=name>换个方向前进</p><p class="site-description motion-element" itemprop=description>在我的电脑上是正常的!</p></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href=/post/><span class=site-state-item-count>28</span>
<span class=site-state-item-name>日志</span></a></div><div class="site-state-item site-state-categories"><a href=/categories/><span class=site-state-item-count>12</span>
<span class=site-state-item-name>分类</span></a></div><div class="site-state-item site-state-tags"><a href=/tags/><span class=site-state-item-count>33</span>
<span class=site-state-item-name>标签</span></a></div></nav><div class="links-of-author motion-element"><span class=links-of-author-item><a href="https://blog.csdn.net/u010837355?type=blog" target=_blank title=CSDN><i class="fa fa-fw fa-globe"></i>
CSDN</a></span>
<span class=links-of-author-item><a href=https://stackoverflow.com/users/17131342/git-zhangzm target=_blank title=StackOverFlow><i class="fa fa-fw fa-globe"></i>
StackOverFlow</a></span></div><div class="links-of-blogroll motion-element links-of-blogroll-inline"><div class=links-of-blogroll-title><i class="fa fa-fw fa-globe"></i>
友情链接</div><ul class=links-of-blogroll-list><li class=links-of-blogroll-item><a href=https://nutzam.com/ title=Nutz target=_blank>Nutz</a></li><li class=links-of-blogroll-item><a href=https://jfinal.com/ title=JFinal target=_blank>JFinal</a></li><li class=links-of-blogroll-item><a href=http://wendal.net/ title=Wendal target=_blank>Wendal</a></li><li class=links-of-blogroll-item><a href=https://www.liaoxuefeng.com/ title=廖雪峰 target=_blank>廖雪峰</a></li></ul></div><div class="tagcloud-of-blogroll motion-element tagcloud-of-blogroll-inline"><div class=tagcloud-of-blogroll-title><i class="fa fa-fw fa-tags"></i>
标签云</div><ul class=tagcloud-of-blogroll-list><li class=tagcloud-of-blogroll-item><a href=/tags/java>Java
<sup>15</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/spring>Spring
<sup>7</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E6%A1%86%E6%9E%B6>框架
<sup>7</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/mysql>Mysql
<sup>5</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/sql>SQL
<sup>5</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/docker>Docker
<sup>4</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF>容器化技术
<sup>4</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/jvm>Jvm
<sup>2</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/mybatis>Mybatis
<sup>2</sup></a></li><li class=tagcloud-of-blogroll-item><a href=/tags/rabbitmq>Rabbitmq
<sup>2</sup></a></li></ul></div></section></div></aside></div></main><footer id=footer class=footer><div class=footer-inner><div class=copyright><span class=copyright-year>&copy; 2010 - 2023</span>
<span class=with-love><i class="fa fa-heart"></i></span>
<span class=copyright-author>换个方向前进</span></div><div class=powered-info><span class=powered-by>Powered by - <a class=powered-link href=//gohugo.io target=_blank title=hugo>Hugo v0.96.0</a></span>
<span class=separator-line>/</span>
<span class=theme-info>Theme by - <a class=powered-link href=//github.com/elkan1788/hugo-theme-next target=_blank>NexT</a></span></div><div class=vistor-info><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script>
<span class=site-uv><i class="fa fa-user"></i>
<span class=busuanzi-value id=busuanzi_value_site_uv></span></span>
<span class=separator-line>/</span>
<span class=site-pv><i class="fa fa-eye"></i>
<span class=busuanzi-value id=busuanzi_value_site_pv></span></span></div><div class=license-info><span class=storage-info>Storage by
<a href=https://www.aliyun.com/ style=font-weight:700 target=_blank>阿里云</a></span>
<span class=separator-line>/</span>
<span class=license-num><a href=http://beian.miit.gov.cn target=_blank>京ICP备2022030480号-1</a></span></div></div></footer><div class=back-to-top><i class="fa fa-arrow-up"></i>
<span id=scrollpercent><span>0</span>%</span></div></div><script type=text/javascript src=//unpkg.com/jquery@2.1.4/dist/jquery.min.js></script>
<script type=text/javascript src=https://zhang4014439175.github.io/js/search.js></script>
<script type=text/javascript src=https://zhang4014439175.github.io/js/affix.js></script>
<script type=text/javascript>function detectIE(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/"),s=e.indexOf("Edge/");return t>0||n>0||s>0?-1:1}function getCntViewHeight(){var t=$("#content").height(),e=$(window).height(),n=t>e?t-e:$(document).height()-e;return n}function getScrollbarWidth(){var e=$("<div />").addClass("scrollbar-measure").prependTo("body"),t=e[0],n=t.offsetWidth-t.clientWidth;return e.remove(),n}function registerBackTop(){var t=50,e=$(".back-to-top");$(window).on("scroll",function(){e.toggleClass("back-to-top-on",window.pageYOffset>t);var s=$(window).scrollTop(),o=getCntViewHeight(),i=s/o,n=Math.round(i*100),a=n>100?100:n;$("#scrollpercent>span").html(a)}),e.on("click",function(){$("html,body").animate({scrollTop:0,screenLeft:0},800)})}function initScrollSpy(){var e=".post-toc",s=$(e),t=".active-current";s.on("activate.bs.scrollspy",function(){var t=$(e+" .active").last();n(),t.addClass("active-current")}).on("clear.bs.scrollspy",n),$("body").scrollspy({target:e});function n(){$(e+" "+t).removeClass(t.substring(1))}}function initAffix(){var e=$(".header-inner").height(),t=parseInt($(".footer").outerHeight(!0),10),n=e+10;$(".sidebar-inner").affix({offset:{top:n,bottom:t}})}function initTOCDimension(){$(window).on("resize",function(){e&&clearTimeout(e),e=setTimeout(function(){var e=document.body.clientHeight-100;updateTOCHeight(e)},0)}),updateTOCHeight(document.body.clientHeight-100);var e,t=getScrollbarWidth();$(".post-toc").css("width","calc(100% + "+t+"px)")}function updateTOCHeight(e){e=e||"auto",$(".post-toc").css("max-height",e)}$(function(){var t=$(".header-inner").height()+10,n,s,e,o;$("#sidebar").css({'margin-top':t}).show(),n=parseInt($("#sidebar").css("margin-top")),s=parseInt($(".sidebar-inner").css("height")),e=n+s,o=$(".content-wrap").height(),o<e&&$(".content-wrap").css("min-height",e),$(".site-nav-toggle").on("click",function(){var e=$(".site-nav"),o=$(".toggle"),t="site-nav-on",i="toggle-close",n=e.hasClass(t),a=n?"slideUp":"slideDown",s=n?"removeClass":"addClass";e.stop()[a]("normal",function(){e[s](t),o[s](i)})}),registerBackTop(),initAffix(),initTOCDimension(),$(".sidebar-nav-toc").click(function(){$(this).addClass("sidebar-nav-active"),$(this).next().removeClass("sidebar-nav-active"),$("."+$(this).next().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)}),$(".sidebar-nav-overview").click(function(){$(this).addClass("sidebar-nav-active"),$(this).prev().removeClass("sidebar-nav-active"),$("."+$(this).prev().attr("data-target")).toggle(500),$("."+$(this).attr("data-target")).toggle(500)})})</script><script src=//unpkg.com/imageviewer@1.1.0/dist/viewer.min.js></script>
<script type=text/javascript>$(function(){$(".post-body").viewer()})</script><script type=text/javascript>const locale={placeholder:"欢迎留下您的宝贵建议，请填写您的昵称和邮箱便于后续交流. ^_^"};$(function(){detectIE()>0?$.getScript(document.location.protocol+"//unpkg.com/@waline/client@1.6.0/dist/Waline.min.js",function(){new Waline({el:"#wcomments",visitor:!0,emoji:[],wordLimit:"200",uploadImage:!1,locale,requiredMeta:["nick","mail"],serverURL:"Your WalineSerURL",lang:"zh-cn"})}):$("#wcomments").html("抱歉，Waline插件不支持IE或Edge，建议使用Chrome浏览器。")})</script><script type=text/javascript src="//s7.addthis.com/js/300/addthis_widget.js#pubid=Your%20AddthisId"></script>
<script>(function(){var e=document.createElement("script"),t,n=window.location.protocol.split(":")[0];n==="https"?e.src="https://zz.bdstatic.com/linksubmit/push.js":e.src="http://push.zhanzhang.baidu.com/push.js",t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script></body></html>